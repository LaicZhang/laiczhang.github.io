<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>LaicZhang&#39;s Blog</title>
  
  <subtitle>If you&#39;re prepared to adapt and learn, you can transform.</subtitle>
  <link href="https://coding.zyha.cn/atom.xml" rel="self"/>
  
  <link href="https://coding.zyha.cn/"/>
  <updated>2024-06-08T06:22:23.000Z</updated>
  <id>https://coding.zyha.cn/</id>
  
  <author>
    <name>laiczhang</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>终端环境下GitHub无法链接</title>
    <link href="https://coding.zyha.cn/cannot-link-github-in-terminal/"/>
    <id>https://coding.zyha.cn/cannot-link-github-in-terminal/</id>
    <published>2024-06-08T06:22:23.000Z</published>
    <updated>2024-06-08T06:22:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>之前github在网页端和terminal中都是可以正常打开的，今天忽然报错无法链接，提示：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git push origin main</span><br><span class="line">kex_exchange_identification: Connection closed by remote host</span><br><span class="line">Connection closed by 198.18.0.21 port 22</span><br><span class="line">fatal: Could not read from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>之前在win上遇到过这个问题，通过修改ssh的config文件解决了。</p><p>在终端输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code ~/.ssh/config</span><br></pre></td></tr></table></figure><p>在vscode中打开，</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Include ~/.orbstack/ssh/config</span><br></pre></td></tr></table></figure><p>发现仅有一行导入orbstack的配置的信息，需要添加github的配置：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">    Hostname ssh.github.com</span><br><span class="line">    Port 443</span><br><span class="line">    User git</span><br></pre></td></tr></table></figure><p>保存后，再次尝试push，应该就可以正常链接了。</p><p>v2ex也早就有大佬@lostberryzz给出了解释，</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">机场屏蔽了落地机到 22 端口的连接，这是很多机场的一贯作坊，防止你通过机场的 IP 去扫描爆破。</span><br><span class="line">而小火箭接管了所有流量导致 git push 用不了，而用 CFW 终端走的是直连自然可以用。</span><br><span class="line"></span><br><span class="line">另外 tun 模式下，ping google 和 github 都返回的是 fake ip ，并不代表真的能 ping 通。</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://docs.github.com/en/authentication/troubleshooting-ssh/using-ssh-over-the-https-port">Using SSH over the HTTPS port</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;之前github在网页端和terminal中都是可以正常打开的，今天忽然报错无法链接，提示：&lt;/p&gt;
&lt;figure class=&quot;highlight txt&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git push origin main&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kex_exchange_identification: Connection closed by remote host&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Connection closed by 198.18.0.21 port 22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fatal: Could not read from remote repository.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Please make sure you have the correct access rights&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;and the repository exists.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="优化" scheme="https://coding.zyha.cn/categories/%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="github" scheme="https://coding.zyha.cn/tags/github/"/>
    
    <category term="ssh" scheme="https://coding.zyha.cn/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>黑神话悟空已开启预售</title>
    <link href="https://coding.zyha.cn/Black-Myth-wukong-has-opened-pre-sale/"/>
    <id>https://coding.zyha.cn/Black-Myth-wukong-has-opened-pre-sale/</id>
    <published>2024-06-08T05:28:11.000Z</published>
    <updated>2024-06-08T05:28:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>目前国区就是最便宜的了。</p><p>直达链接：<a href="https://store.steampowered.com/app/2358720/">https://store.steampowered.com/app/2358720/</a></p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240608133242.png?x-oss-process=style/blog" alt="数字豪华版"></p><span id="more"></span><h2 id="各区比价"><a href="#各区比价" class="headerlink" title="各区比价"></a>各区比价</h2><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240608144636.png?x-oss-process=style/blog" alt="20240608144636"></p><h2 id="官方推荐配置（Windows）"><a href="#官方推荐配置（Windows）" class="headerlink" title="官方推荐配置（Windows）"></a>官方推荐配置（Windows）</h2><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240608145024.png?x-oss-process=style/blog" alt="20240608145024"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;目前国区就是最便宜的了。&lt;/p&gt;
&lt;p&gt;直达链接：&lt;a href=&quot;https://store.steampowered.com/app/2358720/&quot;&gt;https://store.steampowered.com/app/2358720/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.zyha.cn/blog/20240608133242.png?x-oss-process=style/blog&quot; alt=&quot;数字豪华版&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="游戏" scheme="https://coding.zyha.cn/categories/%E6%B8%B8%E6%88%8F/"/>
    
    
    <category term="游戏" scheme="https://coding.zyha.cn/tags/%E6%B8%B8%E6%88%8F/"/>
    
  </entry>
  
  <entry>
    <title>个体户0申报及工商年报提交教程</title>
    <link href="https://coding.zyha.cn/0-report-and-business-license-submission-tutorial-for-individual-entrepreneurs/"/>
    <id>https://coding.zyha.cn/0-report-and-business-license-submission-tutorial-for-individual-entrepreneurs/</id>
    <published>2024-05-28T03:34:42.000Z</published>
    <updated>2024-05-28T03:34:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>重要提醒：根据《个体工商户年度报告暂行办法》规定：个体工商户应当于每年1月1日至6月30日向负责工商行政管理部门报送上一年度年度报告+税务申报（无业务申请0申报即可）</p><p>很多人开电商店铺的时候，办理个体户营业执照，但是因为没有相关经验，不知道自己的义务所在，导致企业状态经营异常，被市场监督管理部门处1万元以下的罚款。在外边请专业的记账报税，其实就是帮你O申报，点点鼠标的事情，一年最少500元+，甚至有的一年，因为这个信息差花1000+元。</p><span id="more"></span><h2 id="0申报"><a href="#0申报" class="headerlink" title="0申报"></a>0申报</h2><ul><li>国家税务局深圳市电子税务局：<a href="https://etax.shenzhen.chinatax.gov.cn/">https://etax.shenzhen.chinatax.gov.cn/</a></li><li>四川电子税务局：<a href="https://tpass.sichuan.chinatax.gov.cn:8443/">https://tpass.sichuan.chinatax.gov.cn:8443/</a></li></ul><p>此处以深圳为例，其他地方的请自行查找。</p><h2 id="工商年报"><a href="#工商年报" class="headerlink" title="工商年报"></a>工商年报</h2><p>按实际填写即可，和税务不关联，主要帮助国家了解你的企业经营状况。</p><h3 id="国家企业信用信息公示系统"><a href="#国家企业信用信息公示系统" class="headerlink" title="国家企业信用信息公示系统"></a>国家企业信用信息公示系统</h3><p>全国统一网址：<a href="http://www.gsxt.gov.cn,选择相应的地区即可,点击“企业信息填报”./">www.gsxt.gov.cn，选择相应的地区即可，点击“企业信息填报”。</a></p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240528114255.png?x-oss-process=style/blog" alt="20240528114255"></p><h3 id="直达四川工商年报"><a href="#直达四川工商年报" class="headerlink" title="直达四川工商年报"></a>直达四川工商年报</h3><p>登录界面： <a href="http://182.131.3.111:8000/noticerpt/user/popup_login">http://182.131.3.111:8000/noticerpt/user/popup_login</a></p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240528114450.png?x-oss-process=style/blog" alt="20240528114450"></p><p>选择【年度报告填写】<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240528114744.png?x-oss-process=style/blog" alt="20240528114744"></p><p>勾选确认</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240528114919.png?x-oss-process=style/blog" alt="20240528114919"></p><p>选择最新一年，</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240528115016.png?x-oss-process=style/blog" alt="20240528115016"></p><p>如果往年已经填写，大致情况没有变，可以直接选择上方的【导入上一年年度信息】<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240528115424.png?x-oss-process=style/blog" alt="20240528115424"></p><p>根据实际情况填写不公示信息<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240528115123.png?x-oss-process=style/blog" alt="20240528115123"></p><p>资产信息，根据我家的情况，填写如下：</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240528115225.png?x-oss-process=style/blog" alt="20240528115225"><br>最后点击保存</p><p>完成填写后，点击左侧【预览并公示】，滑动到最下方，选择【提交并公示】</p><p>最后可以看到公示【已公示】即完成年报的提交。</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240528115818.png?x-oss-process=style/blog" alt="20240528115818"></p><h3 id="个体户公示说明"><a href="#个体户公示说明" class="headerlink" title="个体户公示说明"></a>个体户公示说明</h3><p>6月30日前，可以修改当年报的年报。</p><p>6月30日以后，不能修改年报。6月30日前未完成年报，将面临1万元以下罚款。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;重要提醒：根据《个体工商户年度报告暂行办法》规定：个体工商户应当于每年1月1日至6月30日向负责工商行政管理部门报送上一年度年度报告+税务申报（无业务申请0申报即可）&lt;/p&gt;
&lt;p&gt;很多人开电商店铺的时候，办理个体户营业执照，但是因为没有相关经验，不知道自己的义务所在，导致企业状态经营异常，被市场监督管理部门处1万元以下的罚款。在外边请专业的记账报税，其实就是帮你O申报，点点鼠标的事情，一年最少500元+，甚至有的一年，因为这个信息差花1000+元。&lt;/p&gt;</summary>
    
    
    
    <category term="税务" scheme="https://coding.zyha.cn/categories/%E7%A8%8E%E5%8A%A1/"/>
    
    
    <category term="税务" scheme="https://coding.zyha.cn/tags/%E7%A8%8E%E5%8A%A1/"/>
    
    <category term="个体户" scheme="https://coding.zyha.cn/tags/%E4%B8%AA%E4%BD%93%E6%88%B7/"/>
    
  </entry>
  
  <entry>
    <title>【简单测评】ali成都轻量云年付99元</title>
    <link href="https://coding.zyha.cn/ali-chengdu-light-year-pay-99/"/>
    <id>https://coding.zyha.cn/ali-chengdu-light-year-pay-99/</id>
    <published>2024-05-27T12:15:58.000Z</published>
    <updated>2024-05-27T12:15:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>99元一年的阿里轻量云，还是没忍住下手了。</p><span id="more"></span><h2 id="bench-sh"><a href="#bench-sh" class="headerlink" title="bench.sh"></a>bench.sh</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -qO- bench.sh | bash</span><br></pre></td></tr></table></figure><p>运行结果如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">-------------------- A Bench.sh Script By Teddysun -------------------</span><br><span class="line"> Version            : v2023-10-15</span><br><span class="line"> Usage              : wget -qO- bench.sh | bash</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line"> CPU Model          : Intel(R) Xeon(R) Platinum</span><br><span class="line"> CPU Cores          : 2 @ 2499.998 MHz</span><br><span class="line"> CPU Cache          : 33792 KB</span><br><span class="line"> AES-NI             : ✓ Enabled</span><br><span class="line"> VM-x/AMD-V         : ✗ Disabled</span><br><span class="line"> Total Disk         : 39.2 GB (6.4 GB Used)</span><br><span class="line"> Total Mem          : 1.7 GB (619.2 MB Used)</span><br><span class="line"> System <span class="built_in">uptime</span>      : 74 days, 8 hour 33 min</span><br><span class="line"> Load average       : 0.15, 0.04, 0.01</span><br><span class="line"> OS                 : Ubuntu 22.04.4 LTS</span><br><span class="line"> Arch               : x86_64 (64 Bit)</span><br><span class="line"> Kernel             : 5.15.0-94-generic</span><br><span class="line"> TCP CC             : cubic</span><br><span class="line"> Virtualization     : KVM</span><br><span class="line"> IPv4/IPv6          : ✓ Online / ✗ Offline</span><br><span class="line"> Organization       : AS37963 Hangzhou Alibaba Advertising Co.,Ltd.</span><br><span class="line"> Location           : Chengdu / CN</span><br><span class="line"> Region             : Sichuan</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line"> I/O Speed(1st run) : 109 MB/s</span><br><span class="line"> I/O Speed(2nd run) : 105 MB/s</span><br><span class="line"> I/O Speed(3rd run) : 110 MB/s</span><br><span class="line"> I/O Speed(average) : 108.0 MB/s</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line"> Node Name        Upload Speed      Download Speed      Latency     </span><br><span class="line"> Speedtest.net    3.32 Mbps         102.46 Mbps         2.30 ms     </span><br><span class="line"> Los Angeles, US  3.47 Mbps         111.97 Mbps         185.89 ms   </span><br><span class="line"> Dallas, US       3.56 Mbps         112.24 Mbps         202.24 ms   </span><br><span class="line"> Montreal, CA     3.68 Mbps         110.89 Mbps         248.25 ms   </span><br><span class="line"> Amsterdam, NL    3.57 Mbps         108.68 Mbps         250.85 ms   </span><br><span class="line"> Shanghai, CN     3.35 Mbps         100.61 Mbps         36.12 ms    </span><br><span class="line"> Chongqing, CN    3.31 Mbps         100.70 Mbps         9.04 ms     </span><br><span class="line"> Hongkong, CN     3.37 Mbps         4.85 Mbps           53.34 ms    </span><br><span class="line"> Mumbai, IN       3.61 Mbps         107.89 Mbps         224.83 ms   </span><br><span class="line"> Singapore, SG    3.41 Mbps         42.95 Mbps          112.87 ms   </span><br><span class="line"> Tokyo, JP        3.36 Mbps         3.77 Mbps           96.99 ms    </span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line"> Finished <span class="keyword">in</span>        : 6 min 17 sec</span><br><span class="line"> Timestamp          : 2024-05-27 20:24:50 CST</span><br><span class="line">----------------------------------------------------------------------</span><br></pre></td></tr></table></figure><h2 id="ping测试"><a href="#ping测试" class="headerlink" title="ping测试"></a>ping测试</h2><h3 id="全球ping"><a href="#全球ping" class="headerlink" title="全球ping"></a>全球ping</h3><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://img.tucang.cc/api/image/show/d17cc72b40ecb7365501c081ee994608" alt="ping.pe"></p><h3 id="国内ping"><a href="#国内ping" class="headerlink" title="国内ping"></a>国内ping</h3><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://img.tucang.cc/api/image/show/989cf81bc801f551806898ae9b9ebdb0" alt="itdog.cn"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;99元一年的阿里轻量云，还是没忍住下手了。&lt;/p&gt;</summary>
    
    
    
    <category term="vps" scheme="https://coding.zyha.cn/categories/vps/"/>
    
    
    <category term="vps" scheme="https://coding.zyha.cn/tags/vps/"/>
    
    <category term="ali" scheme="https://coding.zyha.cn/tags/ali/"/>
    
    <category term="cn" scheme="https://coding.zyha.cn/tags/cn/"/>
    
  </entry>
  
  <entry>
    <title>开发中遇到的那些nestjs相关问题</title>
    <link href="https://coding.zyha.cn/some-problems-in-nestjs/"/>
    <id>https://coding.zyha.cn/some-problems-in-nestjs/</id>
    <published>2024-04-20T16:48:23.000Z</published>
    <updated>2024-04-20T16:48:23.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在开发nestjs项目，遇到了一些问题，记录一下。</p><span id="more"></span><h2 id="Nest-静态文件服务"><a href="#Nest-静态文件服务" class="headerlink" title="Nest 静态文件服务"></a>Nest 静态文件服务</h2><p>虽然并没有使用nestjs的静态文件服务作为默认的静态资源地址，但还是可以当作备用方案。很久前就遇到了这个问题，只是看官方的issue和网上的一些blog也没有解决就先放到了一边开发其他功能去了，今天想起来了，解决一下。</p><p>根据官方文档，Nest 静态文件服务需要在项目根目录下创建一个 <code>public</code> 文件夹，然后将静态文件放到这个文件夹下。</p><p>文件路径为：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── package.json</span><br><span class="line">├── public</span><br><span class="line">│   └── foo.png</span><br><span class="line">├── src</span><br><span class="line">│   ├── app.controller.spec.ts</span><br><span class="line">│   ├── app.controller.ts</span><br><span class="line">│   ├── app.module.ts</span><br><span class="line">│   ├── app.service.ts</span><br><span class="line">│   ├── main.ts</span><br><span class="line">├── tsconfig.build.json</span><br><span class="line">├── tsconfig.json</span><br><span class="line">└── yarn.lock</span><br></pre></td></tr></table></figure><p>根据官网示例配置一下import，</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Module</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppController</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.controller&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ServeStaticModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/serve-static&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; join &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  <span class="attr">imports</span>: [</span><br><span class="line">    <span class="title class_">ServeStaticModule</span>.<span class="title function_">forRoot</span>(&#123;</span><br><span class="line">      <span class="attr">rootPath</span>: <span class="title function_">join</span>(__dirname, <span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;public&#x27;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">controllers</span>: [<span class="title class_">AppController</span>],</span><br><span class="line">  <span class="attr">providers</span>: [<span class="title class_">AppService</span>],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>但当打开url <code>http://localhost:3000/public/foo.png</code> 时，浏览器和日志都提示 <code>ENOENT: no such file or directory, stat xxxx/index.html</code>。</p><p>解决方案：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">imports</span>: [ </span><br><span class="line">  <span class="title class_">ServeStaticModule</span>.<span class="title function_">forRoot</span>(&#123;</span><br><span class="line">    <span class="attr">rootPath</span>: <span class="title function_">join</span>(__dirname, <span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;../public&#x27;</span>),</span><br><span class="line">    <span class="attr">serveRoot</span>: <span class="string">&#x27;/public/&#x27;</span></span><br><span class="line">  &#125;),</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>这样就可以通过 <code>http://localhost:3000/public/foo.png</code> 访问静态文件了。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;最近在开发nestjs项目，遇到了一些问题，记录一下。&lt;/p&gt;</summary>
    
    
    
    <category term="后端" scheme="https://coding.zyha.cn/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="node" scheme="https://coding.zyha.cn/tags/node/"/>
    
    <category term="nestjs" scheme="https://coding.zyha.cn/tags/nestjs/"/>
    
    <category term="后端" scheme="https://coding.zyha.cn/tags/%E5%90%8E%E7%AB%AF/"/>
    
    <category term="ts" scheme="https://coding.zyha.cn/tags/ts/"/>
    
  </entry>
  
  <entry>
    <title>浏览器从A到Z</title>
    <link href="https://coding.zyha.cn/a-z-of-browser/"/>
    <id>https://coding.zyha.cn/a-z-of-browser/</id>
    <published>2024-04-17T11:18:23.000Z</published>
    <updated>2024-04-17T11:18:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>看到<a href="blog.skk.moe/post/2023-browser-from-a-to-z/">Sukka</a>大佬的博客，觉得很有意思。于是就想着自己也写一篇。</p><span id="more"></span><h2 id="A"><a href="#A" class="headerlink" title="A"></a>A</h2><ul><li>apad.pro</li></ul><p>开源项目EasyMosdns官方的DNS分流API</p><p>提供DoH协议，仅限研究用途，不承诺SLA</p><p>虽然已经从2019年稳定运行到现在，但是目前每日请求数已经过亿，体验已经远不如前。</p><ul><li>aliyun.com</li></ul><p>阿里云，国内的头部云厂商。</p><h2 id="B"><a href="#B" class="headerlink" title="B"></a>B</h2><ul><li>bilibili.com</li></ul><p>叔叔我啊。。。。</p><ul><li><a href="http://www.bitiful.com/">www.bitiful.com</a></li></ul><p>缤纷云是之前在用的dogedoge搜索的创始人的新项目，目前只有对象村粗和CDN，号称S4，面向国内，功能不及阿里腾讯等，但是价格更便宜，而且有免费的套餐。</p><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><ul><li>chat.openai.com</li></ul><p>OpenAI提供的聊天机器人平台，可以用它来聊天，也可以用它来写作。</p><ul><li><a href="http://www.caniuse.com/">www.caniuse.com</a></li></ul><p>caniuse.com是一个查询浏览器兼容性的网站，可以查询到各个浏览器的最新版本是否支持某个功能。</p><ul><li>cloud.tencent.com</li></ul><p>腾讯云提供的云计算服务，包括云服务器、云数据库、云函数等。</p><h2 id="D"><a href="#D" class="headerlink" title="D"></a>D</h2><ul><li>dash.cloudflare.com</li></ul><p>大慈善家，无需多言。</p><ul><li><a href="http://www.deepl.com/">www.deepl.com</a></li></ul><p>DeepL翻译，免费的网页翻译。虽然有了easydict之后已经很久没有用过了。</p><h2 id="E"><a href="#E" class="headerlink" title="E"></a>E</h2><ul><li>element-plus.org</li></ul><p>ElementPlus，一款基于Vue3的UI组件库，提供了丰富的组件，适合开发PC端和移动端应用。可能是目前Vue生态中最强大的UI组件库。</p><h2 id="F"><a href="#F" class="headerlink" title="F"></a>F</h2><ul><li>fly.io</li></ul><p>Fly.io，一家基于容器技术的云服务提供商，提供免费的静态网站托管服务。但是目前免费服务有限且需要绑卡验证，想要深度体验任然需要付费购买。</p><h2 id="G"><a href="#G" class="headerlink" title="G"></a>G</h2><ul><li>github.com</li></ul><p>世界最大的代码存储库，无需多言。</p><h2 id="H"><a href="#H" class="headerlink" title="H"></a>H</h2><ul><li>hostloc.com</li></ul><p>主机论坛，还算是vps领域最活跃的几个论坛之一了。</p><h2 id="I"><a href="#I" class="headerlink" title="I"></a>I</h2><ul><li><a href="http://www.itdog.cn/">www.itdog.cn</a></li></ul><p>好用的测速工具，可以测出网站在全国范围的响应速度。</p><ul><li>ip.sb&#x2F;</li></ul><p>IP查询，可以查询到当前IP的地理位置。</p><h2 id="J"><a href="#J" class="headerlink" title="J"></a>J</h2><ul><li>juejin.cn</li></ul><p>掘金，前端为主的技术社区，提供优质的技术文章。但是近期我了解到其项目负责人及部分成员已经被优化，前路漫漫。。。</p><h2 id="K"><a href="#K" class="headerlink" title="K"></a>K</h2><ul><li>koajs.com</li></ul><p>Koa，一个基于Node.js的Web框架，提供了一系列功能，包括路由、中间件、插件等。</p><p>曾经基于koa2完成了毕业设计，但是近年来koa的更新其实已经放慢，且更强的框架nest的出现让koa的热度大幅下降。</p><h2 id="L"><a href="#L" class="headerlink" title="L"></a>L</h2><ul><li>localhost</li></ul><p>本地测试，可以用来测试网站的本地运行效果。</p><ul><li>lightsail.aws.amazon.com</li></ul><p>AWS的Lightsail，一款提供免费的云服务器的服务，可以用来快速部署网站。</p><h2 id="M"><a href="#M" class="headerlink" title="M"></a>M</h2><ul><li>my.racknerd.com</li></ul><p>Racknerd，一家提供服务器托管、VPS等服务的公司，提供各种套餐，性价比极高。</p><h2 id="N"><a href="#N" class="headerlink" title="N"></a>N</h2><ul><li><a href="http://www.npmjs.com/">www.npmjs.com</a></li></ul><p>npm，世界上最大的node存储库，提供了大量的开源库，可以用来快速开发项目。</p><h2 id="O"><a href="#O" class="headerlink" title="O"></a>O</h2><ul><li><p><a href="http://www.office.com/">www.office.com</a></p></li><li><p>outlook.live.com</p></li></ul><p>微软提供的办公服务，国内虽然可用，但听说outlook有丢件风险。</p><h2 id="P"><a href="#P" class="headerlink" title="P"></a>P</h2><ul><li><a href="http://www.prisma.io/">www.prisma.io</a></li></ul><p>Prisma，一款基于TypeScript的ORM框架，可以用来快速开发数据库应用。</p><h2 id="Q"><a href="#Q" class="headerlink" title="Q"></a>Q</h2><ul><li>docs.qq.com</li></ul><p>腾讯QQ文档，提供各种技术文档，包括教程、API文档、FAQ等。</p><h2 id="R"><a href="#R" class="headerlink" title="R"></a>R</h2><ul><li>react.dev</li></ul><p>最近想学React，看看官方教程。</p><h2 id="S"><a href="#S" class="headerlink" title="S"></a>S</h2><ul><li><a href="http://www.socpk.com/">www.socpk.com</a></li></ul><p>b站知名up主【极客湾】制作的手机芯片评测网站，可以用来评测手机芯片性能。</p><ul><li><a href="http://www.speedtest.net/">www.speedtest.net</a></li></ul><p>Speedtest，一款测速网站，可以用来测试下载&#x2F;上传&#x2F;延迟等。</p><h2 id="T"><a href="#T" class="headerlink" title="T"></a>T</h2><ul><li>tailwindui.com</li></ul><p>TailwindUI，一款基于TailwindCSS的UI组件库，提供了丰富的组件，适合开发PC端和移动端应用。</p><p>github上有很多TailwindUI的模板，可以参考。</p><p>PS：别人写的样式是真好看。。。</p><h2 id="U"><a href="#U" class="headerlink" title="U"></a>U</h2><ul><li>u.sb</li></ul><p>域名大佬烧饼的博客。</p><h2 id="V"><a href="#V" class="headerlink" title="V"></a>V</h2><ul><li>vercel.com</li></ul><p>Vercel，一家提供静态网站托管、服务器托管、CDN等服务的公司，提供免费的静态网站托管服务。</p><p>对处于vue生态的我真的是很羡慕。</p><ul><li>v2ex.com</li></ul><p>也是一个很知名的程序员社区。</p><h2 id="W"><a href="#W" class="headerlink" title="W"></a>W</h2><ul><li>wordpress.com</li></ul><p>由于谷歌域名业务被出售的原因，我将我的部分域名迁移到来wp，有一说一，界面UI不好看。</p><ul><li>wiki.biligame.com</li></ul><p>B站游戏社区，有很多游戏攻略，可以用来学习游戏攻略。</p><p>而我，原神，启动！</p><h2 id="X"><a href="#X" class="headerlink" title="X"></a>X</h2><ul><li>x.com</li></ul><p>境外微博：）</p><h2 id="Y"><a href="#Y" class="headerlink" title="Y"></a>Y</h2><ul><li><a href="http://www.youtube.com/">www.youtube.com</a></li></ul><p>。。。</p><h2 id="Z"><a href="#Z" class="headerlink" title="Z"></a>Z</h2><ul><li>zhihu.com</li></ul><p>知乎，分享你刚编好的故事。</p><p>已经很久没有登录账号了。一直都是匿名访问。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;看到&lt;a href=&quot;blog.skk.moe/post/2023-browser-from-a-to-z/&quot;&gt;Sukka&lt;/a&gt;大佬的博客，觉得很有意思。于是就想着自己也写一篇。&lt;/p&gt;</summary>
    
    
    
    <category term="浏览器" scheme="https://coding.zyha.cn/categories/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
    
    <category term="前端" scheme="https://coding.zyha.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="浏览器" scheme="https://coding.zyha.cn/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>使用什么作为数据库的ID？</title>
    <link href="https://coding.zyha.cn/what-is-the-best-id-for-a-database/"/>
    <id>https://coding.zyha.cn/what-is-the-best-id-for-a-database/</id>
    <published>2024-04-07T01:19:23.000Z</published>
    <updated>2024-04-07T01:19:23.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>ID 是计算机系统中的重要概念，它用于标识不同的数据实体和交互过程。ID 生成方案是指用于生成唯一标识符（ID）的算法或方法。这些标识符通常用于唯一标识数据库中的记录、消息队列中的消息、分布式系统中的节点等。</p><p>本文建立在本人对过往项目的总结，主要是<code>nestjs+prisma</code>技术栈的代码实现，希望能对大家有所帮助。</p><span id="more"></span><h2 id="理论上ID需要具备的特性"><a href="#理论上ID需要具备的特性" class="headerlink" title="理论上ID需要具备的特性"></a>理论上ID需要具备的特性</h2><p>数据库中的唯一ID（或称为主键）通常需要具备以下特性：</p><ul><li>唯一性（Uniqueness）：每个ID值必须是唯一的，不允许重复。这是主键的最基本特性，确保每行数据都可以通过唯一的标识进行识别和访问。</li><li>不变性（Immutability）：一旦分配给某行数据，ID就不能被更改或重用。这保证了数据的稳定性和一致性，避免了混淆或错误。</li><li>简短性（Shortness）：ID应该足够短以节省存储空间和提高检索效率，同时要足够长以确保唯一性。通常采用自增数字或UUID（通用唯一标识符）等方式生成。</li><li>简单性（Simplicity）：ID应该易于生成、理解和处理，不应过于复杂。这有助于简化开发和维护过程，并提高系统的可靠性。</li><li>可排序性（Sortable）：ID的生成方式应当考虑到其在排序操作中的性能和效率，以便支持一些需要基于ID进行排序的查询操作。</li><li>可读性（Readability）：尽管主键通常是内部使用的标识符，但在某些情况下，例如调试或日志记录，可读性也是一个有用的特性。因此，ID应该以一种可读的格式表示，使其易于识别和理解。</li><li>不含业务含义（No business meaning）：主键应当是无意义的值，不应当包含业务相关的信息。这有助于避免在业务规则变化时引起的问题，并提高系统的灵活性和可扩展性。</li><li>可扩展性（Scalability）：ID生成方式应当能够满足系统的扩展需求，即使在高并发或大规模数据量的情况下也能保持高效和稳定。</li><li>全局唯一性（Global uniqueness）：如果系统是分布式的，那么主键需要保证在全局范围内的唯一性，而不仅仅是在单个数据库或表中。</li></ul><p>综合考虑这些特性，可以选择合适的主键生成方式和存储策略，以满足数据库设计的需求和业务规则的要求。</p><h2 id="常见的ID生成方式"><a href="#常见的ID生成方式" class="headerlink" title="常见的ID生成方式"></a>常见的ID生成方式</h2><h3 id="1-自增ID"><a href="#1-自增ID" class="headerlink" title="1. 自增ID"></a>1. 自增ID</h3><p>最简单的ID生成方式就是自增ID。这种方式的实现方式是，在数据库中创建一个计数器，每次插入新记录时，都将计数器的值加1，作为新记录的ID值。</p><p>优点是简单、易于实现，依赖于所使用数据库的本身机制。分表操作时，下一张表需要知道上一张表最后的id；当存储敏感信息时，可能被他人利用这一特性。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id                Int           @id @default(autoincrement())</span><br></pre></td></tr></table></figure><h3 id="2-UUID"><a href="#2-UUID" class="headerlink" title="2. UUID"></a>2. UUID</h3><p>UUID（通用唯一标识符）是一种由算法生成的字符串，它保证全局唯一性、全球唯一性、时间戳连续性、随机性。</p><p>优点是简单、易于生成、可读性好、无序性。但UUID的长度较长，占用空间也比较大。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id                String        @id @default(uuid())</span><br></pre></td></tr></table></figure><h3 id="3-雪花-Snowflake-算法"><a href="#3-雪花-Snowflake-算法" class="headerlink" title="3. 雪花(Snowflake)算法"></a>3. 雪花(Snowflake)算法</h3><p>Snowflake 是由 Twitter 开发的一种分布式 ID 生成算法，可以保证 ID 的唯一性和足够的可排序性。Snowflake 的 ID 格式为 64 位整数，其中第 1 位为符号位，接下来的 41 位为时间戳，10 位为节点 ID，12 位为序列号。</p><p>Snowflake算法的特性如下：</p><ul><li>唯一性（Uniqueness）：Snowflake算法生成的ID在整个分布式系统中保持唯一性。这是通过将不同的组件（时间戳、机器标识符、序列号）结合在一起生成ID来实现的。</li><li>趋势递增（Increasing trend）：Snowflake生成的ID通常是趋势递增的，即后生成的ID比先生成的ID大。这种特性有助于提高数据库索引效率，减少磁盘碎片等问题。</li><li>可排序性（Sortable）：Snowflake生成的ID可以根据时间戳部分进行排序，因为时间戳部分占据了ID的高位。这使得Snowflake生成的ID在存储和检索时更加高效。</li><li>精度（Precision）：Snowflake算法使用了41位的时间戳，10位的机器标识符和12位的序列号，总共64位。这提供了高达69年的时间精度（2^41 毫秒，约为69年），可以在大多数应用场景下满足需求。</li><li>分布式生成（Distributed generation）：Snowflake算法的设计目标之一是支持分布式生成，即不同的机器可以独立生成ID，而不会发生冲突。这通过在ID中包含机器标识符来实现。</li><li>简单性（Simplicity）：Snowflake算法相对简单，易于实现和部署。它基于时间戳、机器标识符和序列号的组合，使用位运算进行ID的生成，逻辑清晰。</li><li>灵活性（Flexibility）：Snowflake算法允许根据需求调整时间戳的位数、机器标识符的位数和序列号的位数，以适应不同规模和需求的系统。</li><li>可逆性（Reversibility）：Snowflake生成的ID本身不具有可逆性。但是，可以根据ID的结构将其分解为时间戳、机器标识符和序列号等部分，从而了解ID的生成信息。</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; env &#125; <span class="keyword">from</span> <span class="string">&#x27;process&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">SnowFlake</span> &#123;</span><br><span class="line">  <span class="comment">// 系统上线的时间戳，此处设置为 2023-06-22 00:00:00 的时间戳</span></span><br><span class="line">  epoch = <span class="title class_">BigInt</span>(<span class="number">1687392000000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据中心的位数</span></span><br><span class="line">  dataCenterIdBits = <span class="number">5</span>;</span><br><span class="line">  <span class="comment">// 机器id的位数</span></span><br><span class="line">  workerIdBits = <span class="number">5</span>;</span><br><span class="line">  <span class="comment">// 自增序列号的位数</span></span><br><span class="line">  sequenceBits = <span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 最大的数据中心id 这段位运算可以理解为2^5-1 = 31</span></span><br><span class="line">  maxDataCenterId = (<span class="title class_">BigInt</span>(<span class="number">1</span>) &lt;&lt; <span class="title class_">BigInt</span>(<span class="variable language_">this</span>.<span class="property">workerIdBits</span>)) - <span class="title class_">BigInt</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="comment">// 最大的机器id 这段位运算可以理解为2^5-1 = 31</span></span><br><span class="line">  maxWorkerId = (<span class="title class_">BigInt</span>(<span class="number">1</span>) &lt;&lt; <span class="title class_">BigInt</span>(<span class="variable language_">this</span>.<span class="property">workerIdBits</span>)) - <span class="title class_">BigInt</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 时间戳偏移位数</span></span><br><span class="line">  timestampShift = <span class="title class_">BigInt</span>(</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataCenterIdBits</span> + <span class="variable language_">this</span>.<span class="property">workerIdBits</span> + <span class="variable language_">this</span>.<span class="property">sequenceBits</span>,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据中心偏移位数</span></span><br><span class="line">  dataCenterIdShift = <span class="title class_">BigInt</span>(<span class="variable language_">this</span>.<span class="property">workerIdBits</span> + <span class="variable language_">this</span>.<span class="property">sequenceBits</span>);</span><br><span class="line">  <span class="comment">// 机器id偏移位数</span></span><br><span class="line">  workerIdShift = <span class="title class_">BigInt</span>(<span class="variable language_">this</span>.<span class="property">sequenceBits</span>);</span><br><span class="line">  <span class="comment">// 自增序列号的掩码</span></span><br><span class="line">  sequenceMask = (<span class="title class_">BigInt</span>(<span class="number">1</span>) &lt;&lt; <span class="title class_">BigInt</span>(<span class="variable language_">this</span>.<span class="property">sequenceBits</span>)) - <span class="title class_">BigInt</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="comment">// 记录上次生成id的时间戳</span></span><br><span class="line">  lastTimestamp = <span class="title class_">BigInt</span>(-<span class="number">1</span>);</span><br><span class="line">  <span class="comment">// 数据中心id</span></span><br><span class="line">  dataCenterId = <span class="title class_">BigInt</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="comment">// 机器id</span></span><br><span class="line">  workerId = <span class="title class_">BigInt</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="comment">// 自增序列号</span></span><br><span class="line">  sequence = <span class="title class_">BigInt</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">dataCenterId: <span class="built_in">number</span>, workerId: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 校验数据中心 ID 和工作节点 ID 的范围</span></span><br><span class="line">    <span class="keyword">if</span> (dataCenterId &gt; <span class="variable language_">this</span>.<span class="property">maxDataCenterId</span> || dataCenterId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">        <span class="string">`Data center ID must be between 0 and <span class="subst">$&#123;<span class="variable language_">this</span>.maxDataCenterId&#125;</span>`</span>,</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (workerId &gt; <span class="variable language_">this</span>.<span class="property">maxWorkerId</span> || workerId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Worker ID must be between 0 and <span class="subst">$&#123;<span class="variable language_">this</span>.maxWorkerId&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataCenterId</span> = <span class="title class_">BigInt</span>(dataCenterId);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">workerId</span> = <span class="title class_">BigInt</span>(workerId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">nextId</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timestamp = <span class="title class_">BigInt</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>());</span><br><span class="line">    <span class="comment">// 如果上一次生成id的时间戳比下一次生成的还大，说明服务器时间有问题，出现了回退，这时候再生成id，可能会生成重复的id，所以直接抛出异常。</span></span><br><span class="line">    <span class="keyword">if</span> (timestamp &lt; <span class="variable language_">this</span>.<span class="property">lastTimestamp</span>) &#123;</span><br><span class="line">      <span class="comment">// 时钟回拨，抛出异常并拒绝生成 ID</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Clock moved backwards. Refusing to generate ID.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果当前时间戳和上一次的时间戳相等，序列号加一</span></span><br><span class="line">    <span class="keyword">if</span> (timestamp === <span class="variable language_">this</span>.<span class="property">lastTimestamp</span>) &#123;</span><br><span class="line">      <span class="comment">// 同一毫秒内生成多个 ID，递增序列号，防止冲突</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">sequence</span> = (<span class="variable language_">this</span>.<span class="property">sequence</span> + <span class="title class_">BigInt</span>(<span class="number">1</span>)) &amp; <span class="variable language_">this</span>.<span class="property">sequenceMask</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">sequence</span> === <span class="title class_">BigInt</span>(<span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="comment">// 序列号溢出，等待下一毫秒</span></span><br><span class="line">        timestamp = <span class="variable language_">this</span>.<span class="title function_">waitNextMillis</span>(<span class="variable language_">this</span>.<span class="property">lastTimestamp</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 不同毫秒，重置序列号</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">sequence</span> = <span class="title class_">BigInt</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lastTimestamp</span> = timestamp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组合各部分生成最终的 ID，可以理解为把64位二进制转换位十进制数字</span></span><br><span class="line">    <span class="keyword">const</span> id =</span><br><span class="line">      ((timestamp - <span class="variable language_">this</span>.<span class="property">epoch</span>) &lt;&lt; <span class="variable language_">this</span>.<span class="property">timestampShift</span>) |</span><br><span class="line">      (<span class="variable language_">this</span>.<span class="property">dataCenterId</span> &lt;&lt; <span class="variable language_">this</span>.<span class="property">dataCenterIdShift</span>) |</span><br><span class="line">      (<span class="variable language_">this</span>.<span class="property">workerId</span> &lt;&lt; <span class="variable language_">this</span>.<span class="property">workerIdShift</span>) |</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">sequence</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> id.<span class="title function_">toString</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">waitNextMillis</span>(<span class="params">lastTimestamp</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timestamp = <span class="title class_">BigInt</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>());</span><br><span class="line">    <span class="keyword">while</span> (timestamp &lt;= lastTimestamp) &#123;</span><br><span class="line">      <span class="comment">// 主动等待，直到当前时间超过上次记录的时间戳</span></span><br><span class="line">      timestamp = <span class="title class_">BigInt</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> timestamp;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果有pm_id，把pm_id当机器id传进去</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> snowFlake = <span class="keyword">new</span> <span class="title class_">SnowFlake</span>(<span class="number">0</span>, +env.<span class="property">pm_id</span> || <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>综合来看，Snowflake算法是一种在分布式系统中生成唯一ID的高效且可靠的算法，具有较好的唯一性、可排序性和趋势递增性，适用于各种规模的分布式系统。</p><h2 id="4-nanoid"><a href="#4-nanoid" class="headerlink" title="4. nanoid"></a>4. nanoid</h2><p>Nano ID 是一种轻量级、高性能的 ID 生成器，采用了类似 Twitter 的 Snowflake 算法。Nano ID 的长度为 21 个字符，其中 15 个字符用于表示时间戳，6 个字符用于生成随机数，可以保证 ID 的唯一性和足够的随机性。</p><p>适用于高并发环境下的 ID 生成，例如 URL 缩短服务等。但是，Nano ID 不适用于需要支持排序或时间相关操作的场景。</p><p>给<code>prisma</code>提了issue，希望像uuid和自增id那样集成，但根据官方近几个月的release记录来看，目前开发重心是在和<code>drizzle-orm</code>抢市场，至今并未考虑支持。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; nanoid &#125; <span class="keyword">from</span> <span class="string">&#x27;nanoid&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getNanoid</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">nanoid</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-Redis生成id"><a href="#5-Redis生成id" class="headerlink" title="5. Redis生成id"></a>5. Redis生成id</h2><p>Redis是一个高性能的内存数据库，可以用来存储键值对数据，其中值可以是字符串、列表、集合、散列等。Redis的incr命令可以用来生成自增ID，但由于Redis的单线程特性，性能上可能不如其他方案。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文只列举了常见的ID生成方式，实际上还有很多种方式，此处不再列举。在实际的项目中，需要根据实际情况选择合适的ID生成方式，并根据业务规则和性能需求进行优化。</p><p>就个人项目经历，目前uuid已经可以满足大部分需求，其本身由于开源早，所以生态更加丰富，比如<code>class-validator</code>的<code>IsUUID</code>和<code>nestjs</code>的<code>ParseUUIDPipe</code>。当然，如果哪天prisma集成nanoid或snowflake，那我可能就会在新项目中考虑替换了。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;ID 是计算机系统中的重要概念，它用于标识不同的数据实体和交互过程。ID 生成方案是指用于生成唯一标识符（ID）的算法或方法。这些标识符通常用于唯一标识数据库中的记录、消息队列中的消息、分布式系统中的节点等。&lt;/p&gt;
&lt;p&gt;本文建立在本人对过往项目的总结，主要是&lt;code&gt;nestjs+prisma&lt;/code&gt;技术栈的代码实现，希望能对大家有所帮助。&lt;/p&gt;</summary>
    
    
    
    <category term="数据库" scheme="https://coding.zyha.cn/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="数据库" scheme="https://coding.zyha.cn/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="sql" scheme="https://coding.zyha.cn/tags/sql/"/>
    
    <category term="database" scheme="https://coding.zyha.cn/tags/database/"/>
    
  </entry>
  
  <entry>
    <title>docker相关容器配置</title>
    <link href="https://coding.zyha.cn/docker-container-configurations/"/>
    <id>https://coding.zyha.cn/docker-container-configurations/</id>
    <published>2024-03-28T07:24:31.000Z</published>
    <updated>2024-03-28T07:24:31.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一不小心选错了选项，docker直接给我重置了，重新安装一些常用镜像，下面记录一下正在使用的容器和相关配置内容。</p><span id="more"></span><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name nginx \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-p 443:443 \</span><br><span class="line">-v $PWD/nginx/html:/usr/share/nginx/html \</span><br><span class="line">-v $PWD/nginx/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v $PWD/nginx/log:/var/log/nginx \</span><br><span class="line">-v $PWD/nginx/cert:/etc/nginx/cert \</span><br><span class="line">-v $PWD/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf \</span><br><span class="line">--restart=always \</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure><h3 id="postgres"><a href="#postgres" class="headerlink" title="postgres"></a>postgres</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    -e POSTGRES_PASSWORD=mypassword \</span><br><span class="line">    -e POSTGRES_USER=myuser \</span><br><span class="line">    -p 5432:5432 \</span><br><span class="line">    --name mypostgres postgres </span><br></pre></td></tr></table></figure><ul><li>参数POSTGRES_PASSWORD是必需的， POSTGRES_USER它在参数中定义用户的密码。</li><li>参数POSTGRES_USER是可选的，如果未定义，postgres将使用默认用户，可以使用用户名和密码访问数据库。</li></ul><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p>创建目录：<br>mkdir -p $PWD&#x2F;redis&#x2F;conf</p><p>创建文件：<br>touch $PWD&#x2F;redis&#x2F;conf&#x2F;redis.conf</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name redis \</span><br><span class="line">-p 6379:6379 \</span><br><span class="line">--network individual \</span><br><span class="line">-v $PWD/redis/data:/data \</span><br><span class="line">-v $PWD/redis/conf:/etc/redis \</span><br><span class="line">--restart=always \</span><br><span class="line">redis \</span><br><span class="line">redis-server /etc/redis/redis.conf \</span><br><span class="line">--appendonly yes</span><br></pre></td></tr></table></figure><h3 id="minio"><a href="#minio" class="headerlink" title="minio"></a>minio</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run  -p 9000:9000 --name minio \</span><br><span class="line"> -d --restart=always \</span><br><span class="line"> -e MINIO_ACCESS_KEY=minio \</span><br><span class="line"> -e MINIO_SECRET_KEY=minio@123 \</span><br><span class="line"> -v /usr/local/minio/data:/data \</span><br><span class="line"> -v /usr/local/minio/config:/root/.minio \</span><br><span class="line">  minio/minio server /data  --console-address &quot;:9000&quot; --address &quot;:9090&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;一不小心选错了选项，docker直接给我重置了，重新安装一些常用镜像，下面记录一下正在使用的容器和相关配置内容。&lt;/p&gt;</summary>
    
    
    
    <category term="docker" scheme="https://coding.zyha.cn/categories/docker/"/>
    
    
    <category term="vps" scheme="https://coding.zyha.cn/tags/vps/"/>
    
    <category term="docker" scheme="https://coding.zyha.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>关于ApiPost的一些技巧</title>
    <link href="https://coding.zyha.cn/some-tips-about-apipost/"/>
    <id>https://coding.zyha.cn/some-tips-about-apipost/</id>
    <published>2024-03-27T09:53:19.000Z</published>
    <updated>2024-03-27T09:53:19.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="关于ApiPost"><a href="#关于ApiPost" class="headerlink" title="关于ApiPost"></a>关于ApiPost</h2><p>ApiPost是一个国产的类Postman的API调试工具。由于Postman的一些限制，我开始尝试使用ApiPost，在这里记录一些我在使用ApiPost过程中发现的一些技巧。</p><span id="more"></span><h2 id="1-添加Header参数"><a href="#1-添加Header参数" class="headerlink" title="1. 添加Header参数"></a>1. 添加Header参数</h2><p>有两种常用方式，下面以<code>User-Agent</code>字段为例子，</p><h3 id="1-1-添加全局Header参数"><a href="#1-1-添加全局Header参数" class="headerlink" title="1.1 添加全局Header参数"></a>1.1 添加全局Header参数</h3><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240327175713.png?x-oss-process=style/blog" alt="20240327175713"></p><h3 id="1-2-动态添加请求头"><a href="#1-2-动态添加请求头" class="headerlink" title="1.2 动态添加请求头"></a>1.2 动态添加请求头</h3><p>在预执行脚本中添加，</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt.setRequestHeader(&quot;User-Agent&quot;, UA);</span><br></pre></td></tr></table></figure><h2 id="2-添加全局token认证"><a href="#2-添加全局token认证" class="headerlink" title="2. 添加全局token认证"></a>2. 添加全局token认证</h2><h3 id="2-1-添加全局参数"><a href="#2-1-添加全局参数" class="headerlink" title="2.1 添加全局参数"></a>2.1 添加全局参数</h3><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240327180531.png?x-oss-process=style/blog" alt="20240327180531"></p><h3 id="2-2-动态添加请求头"><a href="#2-2-动态添加请求头" class="headerlink" title="2.2 动态添加请求头"></a>2.2 动态添加请求头</h3><p>在预执行脚本中添加，</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt.setRequestHeader(&quot;Authorization&quot;, token);</span><br></pre></td></tr></table></figure><h2 id="3-同步Swagger文档并分享"><a href="#3-同步Swagger文档并分享" class="headerlink" title="3. 同步Swagger文档并分享"></a>3. 同步Swagger文档并分享</h2><p>ApiPost支持同步Swagger文档，可以通过<code>导入</code>功能导入Swagger文档，也可以通过<code>分享</code>功能分享Swagger文档。</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240327175830.png?x-oss-process=style/blog" alt="20240327175830"></p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240327175914.png?x-oss-process=style/blog" alt="20240327175914"></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;关于ApiPost&quot;&gt;&lt;a href=&quot;#关于ApiPost&quot; class=&quot;headerlink&quot; title=&quot;关于ApiPost&quot;&gt;&lt;/a&gt;关于ApiPost&lt;/h2&gt;&lt;p&gt;ApiPost是一个国产的类Postman的API调试工具。由于Postman的一些限制，我开始尝试使用ApiPost，在这里记录一些我在使用ApiPost过程中发现的一些技巧。&lt;/p&gt;</summary>
    
    
    
    <category term="测试" scheme="https://coding.zyha.cn/categories/%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="api" scheme="https://coding.zyha.cn/tags/api/"/>
    
    <category term="测试" scheme="https://coding.zyha.cn/tags/%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>2024选择适合的公共DNS</title>
    <link href="https://coding.zyha.cn/select-a-good-public-dns-in-2024/"/>
    <id>https://coding.zyha.cn/select-a-good-public-dns-in-2024/</id>
    <published>2024-03-20T04:46:36.000Z</published>
    <updated>2024-03-20T04:46:36.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>由于之前用的公共DNS开始变得不稳定，所以重新找一下目前市面上常见的和可能好用的DNS Server。</p><p>选择适合的公共 DNS 对于在中国大陆使用互联网是非常重要的，因为它可以影响到你的网络连接速度、安全性和稳定性。</p><p>主要需要考虑以下因素：</p><ul><li>速度和稳定性：选择一个能够提供良好速度和稳定性的公共 DNS 服务，以确保你的网络连接畅通。</li><li>隐私和安全：一些公共 DNS 提供商可能会收集用户数据，因此你需要选择一个信誉良好、注重隐私保护的服务。</li><li>支持的功能：一些公共 DNS 可能支持额外的功能，如安全过滤、家长控制等，根据你的需求选择合适的服务。</li></ul><span id="more"></span><h2 id="先来了解一下DoT和DoH"><a href="#先来了解一下DoT和DoH" class="headerlink" title="先来了解一下DoT和DoH"></a>先来了解一下DoT和DoH</h2><p>DoT (DNS over TLS) 和 DoH (DNS over HTTPS) 都是用于加密 DNS 流量的协议，它们之间有几个区别：</p><ul><li>传输层协议：<ul><li>DoT：使用传输层安全性协议（TLS）来加密 DNS 查询和响应数据。通常在传输层的 853 端口上运行。</li><li>DoH：将 DNS 查询和响应封装在 HTTPS 请求中，因此可以通过常用的 HTTPS 端口（443）来传输。</li></ul></li><li>部署和支持：<ul><li>DoT：较早被广泛采用，但在某些环境下配置稍微复杂，需要特定的 DNS 服务器支持。</li><li>DoH：由于使用 HTTPS，可以通过现有的 Web 服务器基础架构轻松部署，也更容易穿透防火墙。</li></ul></li><li>性能和适用性：<ul><li>DoT：通常被认为在性能方面稍微优于 DoH，因为 TLS 协议的轻量级封装和较少的额外开销。</li><li>DoH：由于使用 HTTPS，可能会在性能上产生额外的开销，但它的优势在于更易于穿透某些网络配置，尤其是防火墙和代理服务器。</li></ul></li><li>隐私和安全：<ul><li>DoT 和 DoH 都提供了加密传输，从而提高了用户的隐私和安全性，防止了窃听和篡改 DNS 流量的可能性。</li></ul></li></ul><p>综上所述，虽然 DoT 和 DoH 都是用于加密 DNS 流量的有效协议，但它们在实现细节、部署和性能上略有不同，用户可以根据自己的需求和网络环境选择合适的协议。</p><p>于我而言，不缺少那点DNS的解析速度，所以我更倾向于选择更加隐蔽的DoH，因为它更容易穿透防火墙。</p><p>仅列出相对可靠的，其余服务的暂不加入。</p><h2 id="各个厂商对比"><a href="#各个厂商对比" class="headerlink" title="各个厂商对比"></a>各个厂商对比</h2><h3 id="境内"><a href="#境内" class="headerlink" title="境内"></a>境内</h3><table><thead><tr><th>提供方</th><th>国内测速平均响应时间</th><th>IPv4</th><th>IPv6</th><th>稳定性</th><th>DoT</th><th>DoH</th></tr></thead><tbody><tr><td>腾讯 DNSPod</td><td>23ms</td><td>119.29.29.29</td><td>2402:4e00::</td><td>🌟🌟🌟🌟🌟</td><td>dot.pub</td><td><a href="https://doh.pub/dns-query">https://doh.pub/dns-query</a></td></tr><tr><td>阿里巴巴(Alidns)</td><td>21ms</td><td>223.5.5.5, 223.6.6.6</td><td>2400:3200::1, 2400:3200:baba::1</td><td>🌟🌟🌟🌟🌟</td><td>dns.alidns.com</td><td><a href="https://dns.alidns.com/dns-query">https://dns.alidns.com/dns-query</a></td></tr><tr><td>南京信风公共 DNS</td><td>24ms</td><td>114.114.114.114,114.114.115.115</td><td>❌</td><td>🌟🌟🌟🌟</td><td>❌</td><td>❌</td></tr></tbody></table><h3 id="境外"><a href="#境外" class="headerlink" title="境外"></a>境外</h3><table><thead><tr><th>提供方</th><th>国内测速平均响应时间</th><th>IPv4</th><th>IPv6</th><th>稳定性</th><th>DoT</th><th>DoH</th></tr></thead><tbody><tr><td>Google</td><td>108ms</td><td>8.8.8.8,8.8.4.4</td><td>2001:4860:4860::8888 ,2001:4860:4860::8844</td><td>🌟🌟🌟🌟🌟</td><td>dns.google</td><td><a href="https://dns.google/dns-query">https://dns.google/dns-query</a></td></tr><tr><td>Cloudflare</td><td>190ms</td><td>1.0.0.1 ,1.1.1.1</td><td>2606:4700:4700::1111, 2606:4700:4700::1001</td><td>🌟🌟🌟🌟🌟</td><td>cloudflare-dns.com</td><td><a href="https://cloudflare-dns.com/dns-query">https://cloudflare-dns.com/dns-query</a></td></tr></tbody></table><h3 id="小厂商"><a href="#小厂商" class="headerlink" title="小厂商"></a>小厂商</h3><table><thead><tr><th>提供方</th><th>国内测速平均响应时间</th><th>IPv4</th><th>IPv6</th><th>稳定性</th><th>DoT</th><th>DoH</th></tr></thead><tbody><tr><td>dns.sb</td><td>168ms</td><td><code>185.222.222.222</code> <code>45.11.45.11</code></td><td><code>2a09::</code> <code>2a11::</code></td><td>🌟🌟🌟🌟</td><td>dot.sb</td><td><a href="https://doh.sb/dns-query">https://doh.sb/dns-query</a></td></tr><tr><td>EasyMosdns</td><td>30ms</td><td>❌</td><td>❌</td><td>🌟🌟🌟</td><td>❌</td><td><a href="https://doh.apad.pro/dns-query">https://doh.apad.pro/dns-query</a></td></tr><tr><td>cooluc</td><td>30ms</td><td>❌</td><td>❌</td><td>🌟🌟🌟</td><td>dns.cooluc.com</td><td><a href="https://dns.cooluc.com/dns-query">https://dns.cooluc.com/dns-query</a></td></tr></tbody></table><ul><li>cooluc是OpenWRT Mosdns Luci插件作者搭的，大神比较低调，虽然部署在国内，但在特殊时期也会关机保平安</li></ul><h2 id="综上所述"><a href="#综上所述" class="headerlink" title="综上所述"></a>综上所述</h2><p>如果你需要选择公共 DNS 的话同时需要获得尽可能友好的 CDN 解析结果，解析国内站点推荐使用阿里 DNS 和腾讯 DNSPod（注重稳定请用前者、注重准确请用后者）；解析海外网站推荐主 DNS 1.1.1.1。</p><p>而我个人是使用的EasyMosdns，但是付费版本需要25元一个季度，感觉不是很值得，所以暂时还是使用的免费版。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;由于之前用的公共DNS开始变得不稳定，所以重新找一下目前市面上常见的和可能好用的DNS Server。&lt;/p&gt;
&lt;p&gt;选择适合的公共 DNS 对于在中国大陆使用互联网是非常重要的，因为它可以影响到你的网络连接速度、安全性和稳定性。&lt;/p&gt;
&lt;p&gt;主要需要考虑以下因素：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;速度和稳定性：选择一个能够提供良好速度和稳定性的公共 DNS 服务，以确保你的网络连接畅通。&lt;/li&gt;
&lt;li&gt;隐私和安全：一些公共 DNS 提供商可能会收集用户数据，因此你需要选择一个信誉良好、注重隐私保护的服务。&lt;/li&gt;
&lt;li&gt;支持的功能：一些公共 DNS 可能支持额外的功能，如安全过滤、家长控制等，根据你的需求选择合适的服务。&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="dns" scheme="https://coding.zyha.cn/categories/dns/"/>
    
    
    <category term="dns" scheme="https://coding.zyha.cn/tags/dns/"/>
    
  </entry>
  
  <entry>
    <title>使用Lambda监控Lightsail流量限额并超额自动关机</title>
    <link href="https://coding.zyha.cn/use-lambda-to-monitor-lightsail-traffic-limit-and-auto-shutdown-when-exceeding-the-limit/"/>
    <id>https://coding.zyha.cn/use-lambda-to-monitor-lightsail-traffic-limit-and-auto-shutdown-when-exceeding-the-limit/</id>
    <published>2024-03-01T01:03:23.000Z</published>
    <updated>2024-03-01T01:03:23.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>虽然之前写过一篇<a href="https://zyha.cn/">《如何最大限度避免AWS天价账单》</a>，但是这篇文章只做了流量超出提醒，没有提到如何自动关机<del>导致我没注意到邮件而被背刺了</del>。所以这次我打算写一篇关于如何使用Lambda监控Lightsail流量限额并超额自动关机的文章。</p><p>以此纪念上个月我被aws背刺的30刀。</p><span id="more"></span><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>利用Amazon的Lambda函数计算（100W次以内免费），配合Amazon提供的官方Lightsail API，设置定时任务，每10分钟获取当前流量限额和已使用流量，进行对比，如果达到限额的95%，则关闭Lightsail实例：</p><ul><li>利用 <code>Lightsail</code> 的 <code>API</code> 接口： <code>get_instance</code> ，获取账号下在当前区域里的所有 <code>Lightsail</code> 实例。</li><li>根据 <code>Lightsail</code> 实例的类型，获取每个实例每个月的网络流量配额。</li><li>根据实例的创建时间，计算出每个实例在当前这个计费周期内的流量配额。</li><li>通过 <code>API</code> 接口：<code>get_instance_metric_data</code>，获取每个实例已经使用的入站和出站流量总量。</li><li>如果流量超出当前计费周期的配额的<code>95%</code>，并关闭对应的 <code>Lightsail</code> 实例。</li><li>通过 <code>EventBridge</code> 以 <code>cron job</code> 的方式定时触发 <code>Lambda</code>，运行此检查逻辑。</li></ul><h2 id="正式开始"><a href="#正式开始" class="headerlink" title="正式开始"></a>正式开始</h2><h3 id="创建Lambda函数"><a href="#创建Lambda函数" class="headerlink" title="创建Lambda函数"></a>创建Lambda函数</h3><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/a357ffbb527587be4af3cf46b73d5a9d5b124997988e222f4ae4d9019c26adcd.png?x-oss-process=style/blog" alt="aws-lambda-create"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> boto3</span><br><span class="line"><span class="keyword">import</span> calendar</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, date, time,timedelta</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_current_month_first_day_zero_time</span>():</span><br><span class="line">    today = date.today()</span><br><span class="line">    first_day = today.replace(day=<span class="number">1</span>)</span><br><span class="line">    first_day_zero_time = datetime.combine(first_day, time.<span class="built_in">min</span>)</span><br><span class="line">    <span class="keyword">return</span> first_day_zero_time</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_current_month_last_day_last_time</span>():</span><br><span class="line">    today = date.today()</span><br><span class="line">    last_day = today.replace(day=calendar.monthrange(today.year, today.month)[<span class="number">1</span>])</span><br><span class="line">    last_day_last_time = datetime.combine(last_day, time(<span class="number">23</span>, <span class="number">59</span>, <span class="number">59</span>))</span><br><span class="line">    <span class="keyword">return</span> last_day_last_time</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stop_instance</span>(<span class="params">instance_name</span>):</span><br><span class="line">    client = boto3.client(<span class="string">&#x27;lightsail&#x27;</span>)</span><br><span class="line">    response = client.stop_instance(</span><br><span class="line">        instanceName=instance_name,</span><br><span class="line">        force=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_instances</span>(<span class="params">instances_list</span>):</span><br><span class="line">    client = boto3.client(<span class="string">&#x27;lightsail&#x27;</span>)</span><br><span class="line">    paginator = client.get_paginator(<span class="string">&#x27;get_instances&#x27;</span>)</span><br><span class="line">    <span class="comment"># Create a PageIterator from the Paginator</span></span><br><span class="line">    page_iterator = paginator.paginate()</span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> page_iterator:</span><br><span class="line">        <span class="keyword">for</span> instance <span class="keyword">in</span> page[<span class="string">&#x27;instances&#x27;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(instance[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">            instances_list.append(instance[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_month_dto_quota</span>(<span class="params">instance_name</span>):</span><br><span class="line">    client = boto3.client(<span class="string">&#x27;lightsail&#x27;</span>)</span><br><span class="line">    response = client.get_instance(</span><br><span class="line">        instanceName=instance_name</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">#print(&quot;response : &#123;&#125;&quot;.format(response))</span></span><br><span class="line">    dto_quota = response[<span class="string">&#x27;instance&#x27;</span>][<span class="string">&#x27;networking&#x27;</span>][<span class="string">&#x27;monthlyTransfer&#x27;</span>][<span class="string">&#x27;gbPerMonthAllocated&#x27;</span>]</span><br><span class="line">    current_datetime = datetime.now()</span><br><span class="line">    instance_created_datetime = response[<span class="string">&#x27;instance&#x27;</span>][<span class="string">&#x27;createdAt&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> (instance_created_datetime.year == current_datetime.year) <span class="keyword">and</span> (instance_created_datetime.month == current_datetime.month):</span><br><span class="line">        month_ts = get_current_month_last_day_last_time().timestamp() - get_current_month_first_day_zero_time().timestamp()</span><br><span class="line">        instance_valide_ts = get_current_month_last_day_last_time().timestamp() - instance_created_datetime.timestamp()</span><br><span class="line">        dto_quota = (instance_valide_ts/month_ts) * dto_quota</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;created in current month, quota: &#123;&#125;GB&quot;</span>.<span class="built_in">format</span>(dto_quota))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        dto_quota = response[<span class="string">&#x27;instance&#x27;</span>][<span class="string">&#x27;networking&#x27;</span>][<span class="string">&#x27;monthlyTransfer&#x27;</span>][<span class="string">&#x27;gbPerMonthAllocated&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;created in previous month, full quota: &#123;&#125;GB&quot;</span>.<span class="built_in">format</span>(dto_quota))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dto_quota</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_instance_data_usage</span>(<span class="params">instance_name, data_type</span>):</span><br><span class="line">    client = boto3.client(<span class="string">&#x27;lightsail&#x27;</span>)</span><br><span class="line">    current_time = datetime.utcnow()</span><br><span class="line">    start_time = get_current_month_first_day_zero_time()</span><br><span class="line">    end_time = get_current_month_last_day_last_time()</span><br><span class="line">    start_time_str = start_time.strftime(<span class="string">&#x27;%Y-%m-%dT%H:%M:%SZ&#x27;</span>)</span><br><span class="line">    end_time_str = end_time.strftime(<span class="string">&#x27;%Y-%m-%dT%H:%M:%SZ&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">    response = client.get_instance_metric_data(</span><br><span class="line">        instanceName=instance_name,</span><br><span class="line">        metricName=data_type,</span><br><span class="line">        period= <span class="number">6</span> * <span class="number">600</span> * <span class="number">24</span>,</span><br><span class="line">        unit=<span class="string">&#x27;Bytes&#x27;</span>,</span><br><span class="line">        statistics=[</span><br><span class="line">            <span class="string">&#x27;Sum&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        startTime=start_time_str,</span><br><span class="line">        endTime=end_time_str </span><br><span class="line">    )</span><br><span class="line"> </span><br><span class="line">    data_points = response[<span class="string">&#x27;metricData&#x27;</span>]</span><br><span class="line">    total_data_usage = <span class="built_in">sum</span>([data_point[<span class="string">&#x27;sum&#x27;</span>] <span class="keyword">for</span> data_point <span class="keyword">in</span> data_points])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;total &#123;&#125; usage: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(data_type, total_data_usage))</span><br><span class="line">    <span class="keyword">return</span> total_data_usage</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">push_notification</span>(<span class="params">arn, msg</span>):</span><br><span class="line">    sns_client = boto3.client(<span class="string">&#x27;sns&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sqs arn: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(arn))</span><br><span class="line">    response = sns_client.publish(</span><br><span class="line">        TopicArn=arn,</span><br><span class="line">        Message=msg,</span><br><span class="line">        Subject=<span class="string">&#x27;Lightsail NetworkOut exceeded quota &#x27;</span></span><br><span class="line">    )</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lambda_handler</span>(<span class="params">event, context</span>):</span><br><span class="line">    instance_name= []</span><br><span class="line">    list_instances(instance_name)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> instance_name:</span><br><span class="line">        quota = get_month_dto_quota(i) * <span class="number">1000</span> * <span class="number">1000</span> * <span class="number">1000</span></span><br><span class="line">        total = get_instance_data_usage(i, <span class="string">&quot;NetworkOut&quot;</span>) + get_instance_data_usage(i, <span class="string">&quot;NetworkIn&quot;</span>) </span><br><span class="line">        msg = <span class="string">f&quot;instance_name: <span class="subst">&#123;i&#125;</span> \nusage: <span class="subst">&#123;total&#125;</span> Byte \nquota: <span class="subst">&#123;quota&#125;</span> Byte \nusage percent: <span class="subst">&#123;(total/quota)*<span class="number">100</span>&#125;</span> %&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(msg)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">int</span>(quota) * <span class="number">0.95</span>) &lt; <span class="built_in">int</span>(total):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;(quota * 0.95) &lt; total, soforce close instance: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="number">1</span>))</span><br><span class="line">            stop_instance(i)</span><br><span class="line">             </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&#x27;statusCode&#x27;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&#x27;body&#x27;</span>: json.dumps(<span class="string">&#x27;total_data_usage from Lambda!&#x27;</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>设置内存为512MB，超时时间为3分钟。</p><h3 id="创建新策略"><a href="#创建新策略" class="headerlink" title="创建新策略"></a>创建新策略</h3><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240301095032.png?x-oss-process=style/blog" alt="20240301095032"></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Statement&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;lightsail:GetInstance&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;lightsail:GetInstanceMetricData&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;lightsail:GetInstances&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;lightsail:StopInstance&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="创建触发器"><a href="#创建触发器" class="headerlink" title="创建触发器"></a>创建触发器</h3><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240301095802.png?x-oss-process=style/blog" alt="20240301095802"></p><p>时间设置为<code>cron(0/10 * * * ? *)</code>，每十分钟触发一次。</p><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240301100535.png?x-oss-process=style/blog" alt="20240301100535"></p><p>此时就已经基本完成配置了。</p><p>Lambda函数每10分钟执行一次，符合条件就会自动关闭实例。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://www.nodeseek.com/post-73756-1">https://www.nodeseek.com/post-73756-1</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;虽然之前写过一篇&lt;a href=&quot;https://zyha.cn/&quot;&gt;《如何最大限度避免AWS天价账单》&lt;/a&gt;，但是这篇文章只做了流量超出提醒，没有提到如何自动关机&lt;del&gt;导致我没注意到邮件而被背刺了&lt;/del&gt;。所以这次我打算写一篇关于如何使用Lambda监控Lightsail流量限额并超额自动关机的文章。&lt;/p&gt;
&lt;p&gt;以此纪念上个月我被aws背刺的30刀。&lt;/p&gt;</summary>
    
    
    
    <category term="aws" scheme="https://coding.zyha.cn/categories/aws/"/>
    
    
    <category term="aws" scheme="https://coding.zyha.cn/tags/aws/"/>
    
    <category term="lightsail" scheme="https://coding.zyha.cn/tags/lightsail/"/>
    
    <category term="lambda" scheme="https://coding.zyha.cn/tags/lambda/"/>
    
  </entry>
  
  <entry>
    <title>Web应用性能测试优化总结</title>
    <link href="https://coding.zyha.cn/web-performance-test-summary/"/>
    <id>https://coding.zyha.cn/web-performance-test-summary/</id>
    <published>2024-02-10T01:17:41.000Z</published>
    <updated>2024-02-10T01:17:41.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近某个 <code>Web</code> 项目处于开发阶段，要求设计支持上万用户在线的场景。因此需要对应用整体进行性能评估，以便确认应用整体的可容纳在线用户数，因此有性能测试的需要。</p><p>经过评估，我们的应用架构是典型的 <code>SPA (Vue)</code> + 后端 + 数据库应用，因此决定分开评测各自的性能，以便发现各自的性能问题，最终再集成整体评测。</p><p>因此我们分为了三个不同类型的性能测试:</p><ul><li>数据库(PostgreSQL)性能测试</li><li>后端(Nest.js)性能测试</li><li>前端(Vue+Vite)性能测试</li></ul><p>本文分别总结这三个不同场景的性能测试。</p><p>PS: 由于后端部署的环境是 <code>AWS Lightsail</code>，因此我们使用 <code>AWS</code> 提供的 <code>RDS</code> 作为数据库，国内云服务可能部分场景有不同，请考虑相关的替代品。</p><span id="more"></span><h2 id="数据库性能测试"><a href="#数据库性能测试" class="headerlink" title="数据库性能测试"></a>数据库性能测试</h2><p>我们测试的目的是为了发现我们的 <code>SQL</code> 是否会因为数据量大的情况下导致性能下降，因此我们需要先准备好大量的测试数据（填充数据库即可，无需在乎数据质量），然后大规模运行应用程序中可能用到的 <code>SQL</code>，以便发现数据库设计是否有缺陷，<code>SQL</code> 是否有性能问题等等。</p><p>我们使用的数据库为 <code>PostgreSQL</code>，而 <code>PostgreSQL</code> 官方本身就有个性能测试工具<code>pgbench</code>可以实现这一需求。我们直接使用它即可。</p><p><code>pgbench</code>是 <code>PostgreSQL</code> 官方的性能测试工具，它自带有一组脚本，可以默认创建一个数据库并填充自己的数据表，然后运行自己的 <code>SQL</code> 脚本跑测试。显然默认的脚本和配置只能评测数据库服务器本身的性能，并不能发现我们的数据库设计和应用使用的 <code>SQL</code> 的性能隐患，因此我们需要定制 <code>pgbench</code> 的脚本。</p><p>我们需要创建应用自己的数据库（借助 <code>prisma migration</code> 工具完成），然后填充大量的测试数据，最好有一定的随机性。我们自己写个<code>seed.sql</code>，大体内容如下:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 这里我们用generate_series函数生成大量的记录行</span></span><br><span class="line"><span class="comment">-- coln_expr可以使用一些诸如random()函数产生一些随机性</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> my_table (</span><br><span class="line">    col1,</span><br><span class="line">    col2,</span><br><span class="line">    col3,...</span><br><span class="line">    coln</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> col1_expr, col2_expr, col3_expr, ..., coln_expr</span><br><span class="line"><span class="keyword">FROM</span> generate_series(<span class="number">1</span>, <span class="number">1000000</span>);</span><br></pre></td></tr></table></figure><p>我们生成了 100 万条随机记录，可以使用命令<code>psql -f ./seed.sql db</code>向目标数据库插入这 100 万条记录，作为数据准备。</p><p>然后我们需要准备性能测试过程运行的 SQL 语句，再写一个benchmark.sql:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 注意整个benchmark要求必须包裹在整个事务中，因此必须使用BEGIN-END包裹</span></span><br><span class="line"><span class="comment">-- \set是pgbench扩展，可以用于设置一些变量，方便构造随机参数</span></span><br><span class="line"><span class="comment">-- pgbench 可选函数和命令参考官方文档： https://www.postgresql.org/docs/current/pgbench.html</span></span><br><span class="line"></span><br><span class="line">\<span class="keyword">set</span> var1_random random(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">\<span class="keyword">set</span> var2_random random(<span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">\<span class="keyword">set</span> num random(<span class="number">1</span>, <span class="number">100000</span> <span class="operator">*</span> :scale)</span><br><span class="line">\<span class="keyword">set</span> var3_random random(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">\<span class="keyword">set</span> var4_random hash(:num)</span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">SELECT</span> col1, col2 <span class="keyword">from</span> my_table <span class="keyword">WHERE</span> col1 <span class="operator">=</span> :var1 <span class="keyword">AND</span> col2 <span class="operator">=</span> :var2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> my_table <span class="keyword">SET</span> col3 <span class="operator">=</span> :var3 <span class="keyword">WHERE</span> col4 <span class="operator">=</span> :var4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> my_table <span class="keyword">SET</span> col2 <span class="operator">=</span> :var2 <span class="keyword">WHERE</span> some_expr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> my_table (</span><br><span class="line">        col1, col2, col3, col4, ... , coln</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">VALUES</span> (...);</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><p>我们的应用主要使用这几种 SQL 语句，构造好参数之后就可以运行了:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pgbench <span class="operator">-</span>r <span class="operator">-</span>j2 <span class="operator">-</span>c10 <span class="operator">-</span>T120 <span class="operator">-</span>n <span class="operator">-</span>f .<span class="operator">/</span>benchmark.sql db</span><br></pre></td></tr></table></figure><p>我们用 2 线程运行，每个线程运行 10 个客户端，总共运行 2 分钟（120 秒），最终得到的结果大体如下:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pgbench (<span class="number">14.5</span> (Ubuntu <span class="number">14.5</span><span class="number">-0</span>ubuntu0<span class="number">.22</span><span class="number">.04</span><span class="number">.1</span>))</span><br><span class="line">transaction type: .<span class="operator">/</span>benchmark.sql</span><br><span class="line">scaling factor: <span class="number">1</span></span><br><span class="line">query mode: simple</span><br><span class="line">number <span class="keyword">of</span> clients: <span class="number">10</span></span><br><span class="line">number <span class="keyword">of</span> threads: <span class="number">2</span></span><br><span class="line">duration: <span class="number">600</span> s</span><br><span class="line">number <span class="keyword">of</span> transactions actually processed: <span class="number">6426</span></span><br><span class="line">latency average <span class="operator">=</span> <span class="number">934.322</span> ms</span><br><span class="line"><span class="keyword">initial</span> connection <span class="type">time</span> <span class="operator">=</span> <span class="number">171.960</span> ms</span><br><span class="line">tps <span class="operator">=</span> <span class="number">10.702950</span> (<span class="keyword">without</span> <span class="keyword">initial</span> connection <span class="type">time</span>)</span><br><span class="line">statement latencies <span class="keyword">in</span> milliseconds:</span><br><span class="line">         <span class="number">4.767</span>  <span class="keyword">BEGIN</span>;</span><br><span class="line">       <span class="number">160.203</span>  <span class="keyword">SELECT</span> xxx,</span><br><span class="line">       <span class="number">176.959</span>  <span class="keyword">UPDATE</span> xxx</span><br><span class="line">       <span class="number">188.223</span>  <span class="keyword">UPDATE</span> xx</span><br><span class="line">       <span class="number">188.389</span>  <span class="keyword">UPDATE</span> xxx</span><br><span class="line">       <span class="number">187.733</span>  <span class="keyword">UPDATE</span> xx</span><br><span class="line">        <span class="number">18.776</span>  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> xxx (</span><br><span class="line">         <span class="number">9.352</span>  <span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><p>可以清楚的看到每个 SQL 大体上的延迟是多少，就能发现是否存在慢查询以及需要优化的部分了。</p><p>最初我们发现 INSERT 语句延迟较低，而其他 SELECT 和 UPDATE 延迟非常高，因此推断 RDS 实例性能较低，于是升级 RDS 实例规格，并且存储改为 <code>SSD</code> 存储实例之后，性能显著提升，问题得到解决。</p><p>PS: 大部分情况下，升级配置是很好的性能优化手段：）</p><h2 id="后端性能测试"><a href="#后端性能测试" class="headerlink" title="后端性能测试"></a>后端性能测试</h2><p>在数据库的性能测试完成之后，我们可以将数据准备部分复用，直接给后端性能测试的准备数据阶段使用。</p><p>后端性能测试过程中，我们需要模拟大量用户访问后端 API 的情况，以便发现后端 API 处理过程中的性能问题。</p><p>特别注意如果后端有调用第三方接口的情况，需要在测试前进行屏蔽相关功能，或者进行 Mock 接口，防止压力测试中对第三方接口请求量太大从而耗尽配额或者被 ban。</p><p>这里我们选用了 <code>artillery</code> 这个开源工具跑压力测试，因为它使用比较简单，而且未来会有云服务，方便跑分布式压测场景。不过当前版本已经支持运行在 <code>AWS Lambda</code>，我们可以利用这个特性跑简单的分布式压力测试场景。</p><p>我们需要编写好 artillery 的 yaml 配置文件，这里建议参考官方文档，有大量的范例可供参考： <code>https://github.com/artilleryio/artillery/tree/main/examples</code></p><p>我们在 lambda 上运行，启动 40 个 lambda 实例跑测试:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">artillery run --platform aws:lambda --platform-opt region=us-west-1 --count=40 -o result.json config.yml</span><br></pre></td></tr></table></figure><p>得到结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------</span><br><span class="line">Summary report @ 11:50:26(+0800)</span><br><span class="line">--------------------------------</span><br><span class="line"></span><br><span class="line">http.codes.200: ................................................................ 37927</span><br><span class="line">http.codes.201: ................................................................ 60978</span><br><span class="line">http.codes.400: ................................................................ 23046</span><br><span class="line">http.codes.502: ................................................................ 2</span><br><span class="line">http.request_rate: ............................................................. 144/sec</span><br><span class="line">http.requests: ................................................................. 121953</span><br><span class="line">http.response_time:</span><br><span class="line">  min: ......................................................................... 4</span><br><span class="line">  max: ......................................................................... 11839</span><br><span class="line">  median: ...................................................................... 1085.9</span><br><span class="line">  p95: ......................................................................... 5944.6</span><br><span class="line">  p99: ......................................................................... 7407.5</span><br><span class="line">http.responses: ................................................................ 121953</span><br><span class="line">plugins.metrics-by-endpoint.GET /endpoint1/:argument.codes.200: ................ 30441</span><br><span class="line">plugins.metrics-by-endpoint.POST /endpoint1 (offchain).codes.201: .............. 30590</span><br><span class="line">plugins.metrics-by-endpoint.POST /endpoint1 (offchain).codes.502: .............. 1</span><br><span class="line">plugins.metrics-by-endpoint.POST /endpoint1 (onchain).codes.201: ............... 30388</span><br><span class="line">plugins.metrics-by-endpoint.POST /endpoint1 (onchain).codes.502: ............... 1</span><br><span class="line">plugins.metrics-by-endpoint.POST /endpoint2.codes.200: ......................... 7486</span><br><span class="line">plugins.metrics-by-endpoint.POST /endpoint2.codes.400: ......................... 23046</span><br><span class="line">plugins.metrics-by-endpoint.response_time.GET /endpoint1/:targetToken:</span><br><span class="line">  min: ......................................................................... 5</span><br><span class="line">  max: ......................................................................... 5966</span><br><span class="line">  median: ...................................................................... 645.6</span><br><span class="line">  p95: ......................................................................... 2018.7</span><br><span class="line">  p99: ......................................................................... 3464.1</span><br><span class="line">plugins.metrics-by-endpoint.response_time.POST /endpoint1 (offchain):</span><br><span class="line">  min: ......................................................................... 59</span><br><span class="line">  max: ......................................................................... 10607</span><br><span class="line">  median: ...................................................................... 2725</span><br><span class="line">  p95: ......................................................................... 6064.7</span><br><span class="line">  p99: ......................................................................... 7260.8</span><br><span class="line">plugins.metrics-by-endpoint.response_time.POST /endpoint1 (onchain):</span><br><span class="line">  min: ......................................................................... 68</span><br><span class="line">  max: ......................................................................... 11839</span><br><span class="line">  median: ...................................................................... 3464.1</span><br><span class="line">  p95: ......................................................................... 7117</span><br><span class="line">  p99: ......................................................................... 8024.5</span><br><span class="line">plugins.metrics-by-endpoint.response_time.POST /endpoint2:</span><br><span class="line">  min: ......................................................................... 4</span><br><span class="line">  max: ......................................................................... 10146</span><br><span class="line">  median: ...................................................................... 391.6</span><br><span class="line">  p95: ......................................................................... 3752.7</span><br><span class="line">  p99: ......................................................................... 5944.6</span><br><span class="line">vusers.completed: .............................................................. 121953</span><br><span class="line">vusers.created: ................................................................ 121953</span><br><span class="line">vusers.created_by_name.GET /endpoint1/:targetToken: ............................ 30441</span><br><span class="line">vusers.created_by_name.POST /endpoint1 (offchain): ............................. 30591</span><br><span class="line">vusers.created_by_name.POST /endpoint1 (onchain): .............................. 30389</span><br><span class="line">vusers.created_by_name.POST /endpoint2: ........................................ 30532</span><br><span class="line">vusers.failed: ................................................................. 0</span><br><span class="line">vusers.session_length:</span><br><span class="line">  min: ......................................................................... 11</span><br><span class="line">  max: ......................................................................... 11847.7</span><br><span class="line">  median: ...................................................................... 1176.4</span><br><span class="line">  p95: ......................................................................... 5944.6</span><br><span class="line">  p99: ......................................................................... 7407.5</span><br><span class="line">vusers.skipped: ................................................................ 35146</span><br><span class="line">Log file: result.json</span><br><span class="line"></span><br><span class="line">Estimated AWS Lambda cost <span class="keyword">for</span> this <span class="built_in">test</span>: <span class="variable">$0</span>.1833</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通过测试结果，发现了某些 <code>endpoint</code> 接口运行较慢，经过进一步排查最终定位到性能下降的原因进行优化即可。</p><p>最初通过测试报告发现，不请求数据库的 API 性能很高，反之如果 API 有数据库的调用，则压测之后延迟非常高，甚至还有超时错误。最终排查之后发现还是是数据库连接池的库性能较差，更换新的数据库 driver，并且优化部分 SQL 之后性能问题得到很大的改善。</p><h2 id="前端性能测试"><a href="#前端性能测试" class="headerlink" title="前端性能测试"></a>前端性能测试</h2><p>前端性能测试主要包含用户的加载页面速度和页面渲染的速度两方面，我们可以通过配合 <code>lighthouse</code> 和 <code>artillery + playwright</code> 实现。</p><p><code>lighthouse</code> 可以重点帮助分析页面渲染方面的最佳实践，而 <code>artillery + playwright</code> 的组合可以方便的模拟大量用户反复点击某些页面之后，页面加载速度的情况，可以更准确的得到页面相关的 FCP 等重要参数。</p><p>特别注意 <code>playwright</code> 运行浏览器的时候，如果需要加载浏览器插件，无法通过访问在线商店的方式进行安装，必须将插件下载到本地之后使用 <code>playwright API</code>进行加载。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------</span><br><span class="line">Summary report @ 17:24:38(+0000)</span><br><span class="line">--------------------------------</span><br><span class="line"></span><br><span class="line">browser.http_requests: ......................................................... 4392</span><br><span class="line">browser.page.CLS.e2e <span class="built_in">test</span>:</span><br><span class="line">  min: ......................................................................... 0</span><br><span class="line">  max: ......................................................................... 0</span><br><span class="line">  median: ...................................................................... 0</span><br><span class="line">  p95: ......................................................................... 0</span><br><span class="line">  p99: ......................................................................... 0</span><br><span class="line">browser.page.FCP.e2e <span class="built_in">test</span>:</span><br><span class="line">  min: ......................................................................... 311.1</span><br><span class="line">  max: ......................................................................... 1307.7</span><br><span class="line">  median: ...................................................................... 415.8</span><br><span class="line">  p95: ......................................................................... 925.4</span><br><span class="line">  p99: ......................................................................... 1249.1</span><br><span class="line">browser.page.FID.e2e <span class="built_in">test</span>:</span><br><span class="line">  min: ......................................................................... 1.7</span><br><span class="line">  max: ......................................................................... 22.2</span><br><span class="line">  median: ...................................................................... 2.5</span><br><span class="line">  p95: ......................................................................... 9.5</span><br><span class="line">  p99: ......................................................................... 12.6</span><br><span class="line">browser.page.LCP.e2e <span class="built_in">test</span>:</span><br><span class="line">  min: ......................................................................... 726.6</span><br><span class="line">  max: ......................................................................... 2226.1</span><br><span class="line">  median: ...................................................................... 788.5</span><br><span class="line">  p95: ......................................................................... 2018.7</span><br><span class="line">  p99: ......................................................................... 2143.5</span><br><span class="line">browser.page.TTFB.e2e <span class="built_in">test</span>:</span><br><span class="line">  min: ......................................................................... 35.5</span><br><span class="line">  max: ......................................................................... 494</span><br><span class="line">  median: ...................................................................... 48.9</span><br><span class="line">  p95: ......................................................................... 125.2</span><br><span class="line">  p99: ......................................................................... 478.3</span><br><span class="line">vusers.completed: .............................................................. 28</span><br><span class="line">vusers.created: ................................................................ 36</span><br><span class="line">vusers.created_by_name.e2e <span class="built_in">test</span>: ............................................... 36</span><br><span class="line">vusers.failed: ................................................................. 8</span><br><span class="line">vusers.session_length:</span><br><span class="line">  min: ......................................................................... 3314.8</span><br><span class="line">  max: ......................................................................... 6396.5</span><br><span class="line">  median: ...................................................................... 3534.1</span><br><span class="line">  p95: ......................................................................... 5826.9</span><br><span class="line">  p99: ......................................................................... 6187.2</span><br><span class="line">vusers.skipped: ................................................................ 204</span><br><span class="line">Log file: result.json</span><br></pre></td></tr></table></figure><p>特别注意 <code>playwright</code> 当前无法在 <code>lambda</code> 环境下运行。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本文我们大体总结了一个 Web 应用在性能测试方面的套路，以便指导发现应用的性能问题，从而优化应用本身。</p>]]></content>
    
    
    <summary type="html">本文总结了一个 Web 应用在性能测试方面的套路，以便指导发现应用的性能问题，从而优化应用本身。</summary>
    
    
    
    <category term="优化" scheme="https://coding.zyha.cn/categories/%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="性能测试" scheme="https://coding.zyha.cn/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"/>
    
    <category term="web" scheme="https://coding.zyha.cn/tags/web/"/>
    
    <category term="sql" scheme="https://coding.zyha.cn/tags/sql/"/>
    
  </entry>
  
  <entry>
    <title>prisma使用3个月有感</title>
    <link href="https://coding.zyha.cn/prisma-has-been-used-for-3-months/"/>
    <id>https://coding.zyha.cn/prisma-has-been-used-for-3-months/</id>
    <published>2023-10-08T14:46:04.000Z</published>
    <updated>2024-06-07T03:06:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>用了3个月的prisma，作为和TypeOrm可以说占据了大部分的node后端orm份额，但实际我个人用起来，虽然在参数类型上比较方便，但其他还有值得改进的点，但官方给人的感觉就很傲慢，就这个态度，在我看来目前还称不上<code>下一代ORM</code>。</p><p>因为本人主要做前端开发，写后端只是顺带，所以一定会有不了解的地方。以下为个人使用过程中遇到的，仅作记录。</p><ul><li>2024.4.21 更新： <code>5.12.0</code> 发布，sqlite支持了<code>createMany</code>方法。</li><li>2024.6.7 更新： <code>5.15.0</code> 发布，支持拆分配置文件<span id="more"></span></li></ul><h2 id="不错的点"><a href="#不错的点" class="headerlink" title="不错的点"></a>不错的点</h2><h3 id="提供操作的类型可以直接使用"><a href="#提供操作的类型可以直接使用" class="headerlink" title="提供操作的类型可以直接使用"></a>提供操作的类型可以直接使用</h3><p>比如，我想插入一条user数据，我可以直接使用<code>Prisma.UserCreateInput</code>，而不需要自己定义一个<code>interface</code>，这点我觉得非常不错。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="attr">data</span>: <span class="title class_">Prisma</span>.<span class="property">UserCreateInput</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">User</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      data.<span class="property">password</span> = <span class="keyword">await</span> <span class="title function_">hashPassword</span>(data.<span class="property">password</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">prisma</span>.<span class="property">user</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">        data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">HttpExceptionFilter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>除了<code>Prisma.UserCreateInput</code>，还有<code>Prisma.UserUpdateInput</code>，<code>Prisma.UserWhereUniqueInput</code>等等，这些都是prisma自动生成的，非常方便。但是仍然有不完美的地方就是，自动生成的类型无法在swagger中直接使用，</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiBody</span>(&#123; <span class="attr">type</span>: <span class="function">() =&gt;</span> <span class="title class_">Prisma</span>.<span class="property">UserUpdateInput</span> &#125;)</span><br><span class="line"><span class="comment">// error TS2339: Property &#x27;UserCreateInput&#x27; does not exist on type &#x27;typeof Prisma&#x27;.</span></span><br></pre></td></tr></table></figure><p>需要自己去implements一下。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">CreateUserDto</span> <span class="keyword">implements</span> <span class="title class_">Prisma</span>.<span class="property">UserCreateInput</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiBody</span>(&#123; <span class="attr">type</span>: <span class="function">() =&gt;</span> <span class="title class_">CreateUserDto</span> &#125;)</span><br></pre></td></tr></table></figure><h2 id="社区认为值得改进但官方并不重视"><a href="#社区认为值得改进但官方并不重视" class="headerlink" title="社区认为值得改进但官方并不重视"></a>社区认为值得改进但官方并不重视</h2><h3 id="issue及pr处理不积极"><a href="#issue及pr处理不积极" class="headerlink" title="issue及pr处理不积极"></a>issue及pr处理不积极</h3><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240607130914.png?x-oss-process=style/blog" alt="20240607130914"></p><p>官方仓库<a href="https://github.com/prisma/prisma">prisma&#x2F;prisma</a>的<code>issue</code>及<code>pr</code>处理速度非常慢，而且很多<code>issue</code>都没有回复，且已经提了的pr也长期不处理。</p><p>在issue提出的问题，如果官方认为社区可以解决是会马上被转移至Discussion区的，所以可见接近3k的issue是值得官方来进行解决和说明的。</p><h3 id="核心功能缺失"><a href="#核心功能缺失" class="headerlink" title="核心功能缺失"></a><del>核心功能缺失</del></h3><p><strong>prisma 5.12.0 版本，sqlite已经支持<code>createMany</code>方法。猜测一下，多半是因为其竞品<code>drizzle</code>以及<code>cloudflare D1</code>正式发布的原因</strong></p><p>我开始的时候使用<code>SQLite</code>进行开发，但是在使用过程中发现<code>prisma</code>的<code>Sqlite</code>支持非常不完善，甚至可以说是部分功能完全不可用，比如说：</p><ul><li><code>createMany</code>，作为<code>ORM</code>，我个人认为这是最核心这个功能，然而在<code>Sqlite</code>中是不支持的，很久的<code>issue</code>了。<ul><li><a href="https://github.com/prisma/prisma/issues/21206">createMany is a very worth considering for testing in sqlite development mode #21206</a></li><li><a href="https://github.com/prisma/prisma/issues/10710">Add the createMany method to SQLite #10710</a></li><li><a href="https://github.com/prisma/prisma/issues/11507">prisma.model.createMany is not a function #11507</a></li></ul></li></ul><p><code>prisma</code>团队以性能问题，一直没有解决，这个功能在我看来是非常基础的功能。开发者也明确说明了不需要在乎性能，就是想做开发测试，但是<code>prisma</code>却仍然没有支持，这让我非常不解，最后不得不换到了<code>postgres</code>上。</p><h3 id="提出的优秀feat官方并不进行支持"><a href="#提出的优秀feat官方并不进行支持" class="headerlink" title="提出的优秀feat官方并不进行支持"></a>提出的优秀feat官方并不进行支持</h3><ul><li><del>不支持拆分配置文件。<code>prisma</code>的数据模型设计文件并非<code>.ts</code>，而是自定义的<code>*.prisma</code>。以我正在开发中的项目为例子，目前只设计了<code>62</code>张表，<code>schema.prisma</code>（<code>prisma</code>默认存放表结构的文件）已经<code>800+</code>行。</del> 最新版本已经支持。<ul><li><del><a href="https://github.com/prisma/prisma/issues/2377">Support for splitting Prisma schema into multiple files #2377</a></del></li></ul></li><li>不提供<code>@default(nanoid())</code>，只支持<code>@default(uuid())</code>。<ul><li><a href="https://github.com/prisma/prisma/issues/18612">Implement nanoid() #18612</a></li><li><a href="https://github.com/prisma/prisma/issues/17294">Make @default(nanoid()) alphabet configurable #17294</a></li></ul></li></ul><h3 id="Bug年久失修"><a href="#Bug年久失修" class="headerlink" title="Bug年久失修"></a>Bug年久失修</h3><ul><li>schema.prisma中定义，</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model Answer &#123;</span><br><span class="line">  id String @id @default(cuid())</span><br><span class="line">  question Question @relation(fields: [questionId], references: [id], onDelete: Cascade)</span><br><span class="line">  questionId String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在代码中使用</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">create</span>(<span class="params">questionId: <span class="built_in">string</span>, input: AnswerInput</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">prisma</span>.<span class="property">answer</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">    ...input,</span><br><span class="line">    questionId,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上，看起来没错，但是， <a href="https://github.com/prisma/prisma/issues/15946">Type ‘string’ is not assignable to type ‘never’ #15946 - @DiogoMarques2003 opened this issue on Oct 24, 2022</a></p><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>希望prisma能够越来越好，但是目前来看，我个人认为prisma还不够成熟，还有很多需要完善的feat。</p>]]></content>
    
    
    <summary type="html">prisma使用3个月有感,prisma是什么,prisma的优缺点</summary>
    
    
    
    <category term="后端" scheme="https://coding.zyha.cn/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="sql" scheme="https://coding.zyha.cn/tags/sql/"/>
    
    <category term="orm" scheme="https://coding.zyha.cn/tags/orm/"/>
    
    <category term="api" scheme="https://coding.zyha.cn/tags/api/"/>
    
  </entry>
  
  <entry>
    <title>vite4.3是如何更快的</title>
    <link href="https://coding.zyha.cn/vite4-3-is-faster/"/>
    <id>https://coding.zyha.cn/vite4-3-is-faster/</id>
    <published>2023-09-21T02:26:26.000Z</published>
    <updated>2023-09-21T02:26:26.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20240410171659.png?x-oss-process=style/blog" alt="vite4.3启动时间"></p><p>正如<a href="https://github.com/sapphi-red/">@sapphi-red</a>所说，Vite 4.3比Vite 4.2性能得到了极大提高。</p><p>除大概阐述外，我还找了一些具有代表性的PR，来看看Vite 4.3具体是如何做到的。</p><span id="more"></span><h2 id="为什么Vite-4-3比Vite-4-2性能提高了这么多"><a href="#为什么Vite-4-3比Vite-4-2性能提高了这么多" class="headerlink" title="为什么Vite 4.3比Vite 4.2性能提高了这么多"></a>为什么Vite 4.3比Vite 4.2性能提高了这么多</h2><h3 id="1-更智能的调度策略"><a href="#1-更智能的调度策略" class="headerlink" title="1. 更智能的调度策略"></a>1. 更智能的调度策略</h3><p>Vite解析所有收到的URL和路径，以获取目标模块。</p><p>在Vite 4.2中，有许多冗余的解析逻辑和不必要的模块搜索。Vite 4.3使解析逻辑更简单、更严格、更准确，以减少计算和fs调用。</p><h4 id="1-1-简化调度-12576"><a href="#1-1-简化调度-12576" class="headerlink" title="1.1 简化调度 #12576"></a>1.1 简化调度 <a href="https://github.com/vitejs/vite/pull/12576">#12576</a></h4><p>Vite 4.2严重依赖<a href="https://www.npmjs.com/package/resolve">resolve</a>包来解析依赖的package.json，当我们查看resolve源码时，可以发现在解析package.json时有很多无用的逻辑。 Vite 4.3 放弃了解析，遵循更简单的解析逻辑：直接检查嵌套父目录中是否存在 package.json。</p><h4 id="1-2-更严格的解析-12542"><a href="#1-2-更严格的解析-12542" class="headerlink" title="1.2 更严格的解析 #12542"></a>1.2 更严格的解析 <a href="https://github.com/vitejs/vite/pull/12542">#12542</a></h4><p>Vite要调用Nodejs fs API 来查找模块，但IO操作是很消耗资源的。 Vite 4.3缩小了文件搜索范围，并跳过了一些特殊路径的搜索，以尽可能减少fs调用。</p><p>例如：</p><ul><li><p>由于#符号不会出现在URL中，并且用户可以控制源文件路径中不包含#符号，因此Vite 4.3不再检查用户源文件中带有#符号的路径，而只在node_modules中搜索。</p></li><li><p>在 Unix 系统中，Vite 4.2 首先检查根目录内的每个绝对路径，对于大多数路径都没有问题，但如果绝对路径以 root 开头，则很可能失败。为了在 &#x2F;root&#x2F;root 不存在时跳过搜索 &#x2F;root&#x2F;root&#x2F;文件路径，Vite 4.3 会在开头判断 &#x2F;root&#x2F;root 是否作为目录存在，并预先缓存结果。</p></li><li><p>当Vite服务器收到@fs&#x2F;xxx和@vite&#x2F;xxx时，无需再次解析这些UR L。 Vite 4.3 直接返回之前缓存的结果，而不是重新解析它们。</p></li></ul><h4 id="1-3-更准确的解析-12542"><a href="#1-3-更准确的解析-12542" class="headerlink" title="1.3 更准确的解析 #12542"></a>1.3 更准确的解析 <a href="https://github.com/vitejs/vite/pull/12542">#12542</a></h4><p>Vite 4.2 当文件路径为目录时会递归解析模块，这会导致不必要的重复计算。 Vite 4.3将递归分辨率扁平化，针对不同类型的路径应用合适的分辨率。展平后缓存一些 fs 调用也更容易。</p><h4 id="1-4-更快的解析-12476"><a href="#1-4-更快的解析-12476" class="headerlink" title="1.4 更快的解析 #12476"></a>1.4 更快的解析 <a href="https://github.com/vitejs/vite/issues/12476">#12476</a></h4><p>Vite 4.3打破了解析node_modules包数据的性能瓶颈。</p><p>Vite 4.2 使用绝对文件路径作为包数据缓存键。这还不够，因为 Vite 必须遍历 pkg&#x2F;foo&#x2F;bar 和 pkg&#x2F;foo&#x2F;baz 中的同一目录。</p><p>Vite 4.3 不仅使用绝对路径（&#x2F;root&#x2F;node _modules&#x2F;pkg&#x2F;foo&#x2F;bar.js &amp; &#x2F;root&#x2F;node_modules&#x2F;pkg&#x2F;foo&#x2F;baz.js），还使用遍历的目录（&#x2F;root&#x2F;node_modules&#x2F;pkg&#x2F;foo&#x2F;bar.js） module&#x2F;pkg&#x2F;foo &amp; &#x2F;root&#x2F;node_modules&#x2F;pkg) 作为 pkg 缓存的键。</p><p>另一种情况是，Vite 4.2 在单个函数内部查找深层导入路径的 package.json，例如 Vite 4.2 解析 a&#x2F;b&#x2F;c&#x2F;d 这样的文件路径时，首先会检查 root a&#x2F;package.json 是否存在，如果没有，则按照a&#x2F;b&#x2F;c&#x2F;package.json -&gt; a&#x2F;b&#x2F;package.json的顺序查找最近的package.json，但事实是查找根package.json和最近的package.json应该处理分开，因为它们在不同的解析上下文中需要。 Vite 4.3 将根 package.json 和最近的 package.json 解析分为两部分，这样它们就不会混合。</p><h3 id="2-fs-realpathSync-2680"><a href="#2-fs-realpathSync-2680" class="headerlink" title="2. fs.realpathSync #2680"></a>2. fs.realpathSync <a href="https://github.com/nodejs/node/issues/2680">#2680</a></h3><p>Nodejs 中有一个有趣的 realpath Sync 问题，它指出 fs.realpath Sync 比 fs.realpath Sync.native 慢 70 倍。</p><p>但由于在 Windows 上的行为不同，Vite 4.2 仅在非 Windows 系统上使用 fs.realpathSync.native。为了解决这个问题，Vite 4.3 在 Windows 上调用 fs.realpath Sync.native 时添加了网络驱动器验证。</p><h3 id="3-非阻塞任务"><a href="#3-非阻塞任务" class="headerlink" title="3. 非阻塞任务"></a>3. 非阻塞任务</h3><p>作为一种按需服务，Vite 开发服务器不需要所有东西都准备好就可以启动。</p><h4 id="3-1-非阻塞tsconfig解析-12548"><a href="#3-1-非阻塞tsconfig解析-12548" class="headerlink" title="3.1 非阻塞tsconfig解析 #12548"></a>3.1 非阻塞tsconfig解析 <a href="https://github.com/vitejs/vite/issues/12548">#12548</a></h4><p>Vite 服务器在预捆绑 ts 或 tsx 时需要 tsconfig 数据。</p><p>Vite 4.2 在服务器启动之前等待插件钩子配置中的 tsconfig 数据被解析解析。一旦服务器启动而没有准备好 tsconfig 数据，页面请求就可以访问服务器，即使该请求可能需要稍后等待 tsconfig 解析。</p><p>Vite 4.3 在服务器启动之前初始化 tsconfig 解析，但服务器不会等待它。解析过程在后台运行。一旦有 ts 相关的请求进来，就必须等待 tsconfig 解析完成。</p><h4 id="3-2-非阻塞文件处理-12603"><a href="#3-2-非阻塞文件处理-12603" class="headerlink" title="3.2 非阻塞文件处理 #12603"></a>3.2 非阻塞文件处理 <a href="https://github.com/vitejs/vite/issues/12603">#12603</a></h4><p>Vite中有大量的fs调用，其中一些是同步的。这些同步 fs 调用可能会阻塞主线程。 Vite 4.3 将它们更改为异步。此外，异步函数的并行化也更容易。关于异步函数，您应该关心的一件事是，在解析后可能有许多 Promise 对象需要释放。由于更智能的解析策略，释放 fs - Promise 对象的成本要少得多。</p><h3 id="4-HMR-优化-12658"><a href="#4-HMR-优化-12658" class="headerlink" title="4. HMR 优化 #12658"></a>4. HMR 优化 <a href="https://github.com/vitejs/vite/issues/12658">#12658</a></h3><p>考虑两个简单的依赖链C &lt; - B &lt; - A &amp; D &lt; - B &lt; - A，当A被编辑时，HMR会从A传播到C，从A传播到D。这导致A和B在Vite中被更新两次4.2.<br>Vite 4.3 会缓存这些遍历过的模块，以避免多次探索它们。这可能会对那些具有组件桶导入的文件结构产生重大影响。这对于 git checkout 触发的 HMR 也有好处。</p><h3 id="5-并行化-12754"><a href="#5-并行化-12754" class="headerlink" title="5. 并行化 #12754"></a>5. 并行化 <a href="https://github.com/vitejs/vite/issues/12754">#12754</a></h3><p>并行化始终是获得更好性能的不错选择。在 Vite 4.3 中，我们并行化了一些核心功能，包括导入分析、提取 deps 的导出、解析模块 url 和运行批量优化器。并行化之后确实有令人印象深刻的改进。</p><h3 id="6-JavaScript-优化"><a href="#6-JavaScript-优化" class="headerlink" title="6. JavaScript 优化"></a>6. JavaScript 优化</h3><p>不要错过编程语言优化。 Vite 4.3 中一些有趣的 javascript 优化案例：</p><h4 id="6-1-用回调替换-yield-12541"><a href="#6-1-用回调替换-yield-12541" class="headerlink" title="6.1 用回调替换 *yield #12541"></a>6.1 用回调替换 *yield <a href="https://github.com/vitejs/vite/issues/12541">#12541</a></h4><p>Vite 使用 tsconfck(by @dominikg) 来查找和解析 tsconfig 文件。 tsconfck 过去通过 <em>yield 遍历目标目录，生成器的一个缺点是它需要更多的内存空间来存储其 Generator 对象，并且在运行时会有大量的生成器上下文切换。所以@dominikg 自 v2.1.1 以来在核心中用回调替换了</em>yield 。</p><h4 id="6-2-使用-startsWith-endsWith-替换-12531"><a href="#6-2-使用-startsWith-endsWith-替换-12531" class="headerlink" title="6.2 使用 startsWith &amp; endsWith 替换 &#x3D;&#x3D;&#x3D; #12531"></a>6.2 使用 startsWith &amp; endsWith 替换 &#x3D;&#x3D;&#x3D; <a href="https://github.com/vitejs/vite/issues/12531">#12531</a></h4><p>Vite 4.2 使用开头 With 和结尾 With 来检查热 UR L 中的标题和尾随“&#x2F;”。我们比较了 str.starts With(‘x’) 和 str[0] &#x3D;&#x3D;&#x3D; ‘x’ 的执行基准，发现 &#x3D;&#x3D;&#x3D; 比starts With 快约 20%。同时，ends With 比 &#x3D;&#x3D;&#x3D; 慢约 60%。</p><h4 id="6-3-避免重新创建正则表达式-12518"><a href="#6-3-避免重新创建正则表达式-12518" class="headerlink" title="6.3 避免重新创建正则表达式 #12518"></a>6.3 避免重新创建正则表达式 <a href="https://github.com/vitejs/vite/issues/12518">#12518</a></h4><p>Vite需要很多正则表达式来匹配字符串，其中大多数都是静态的，所以最好只使用它们的单例。 Vite 4.3 提升了正则表达式，以便可以重复使用它们。</p><h4 id="6-4-放弃生成自定义错误"><a href="#6-4-放弃生成自定义错误" class="headerlink" title="6.4 放弃生成自定义错误"></a>6.4 放弃生成自定义错误</h4><p>Vite 4.2 中存在一些为了更好的 DX 的自定义错误。这些错误可能会导致额外的计算和垃圾收集，从而降低 Vite 的速度。在 Vite 4.3 中，我们必须放弃生成一些热门的自定义错误（例如 package.json NOT _ FOUND 错误）并直接抛出原始错误以获得更好的性能。</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="https://vitejs.dev/blog/announcing-vite4-3.html">Vite 4.3 is out!</a></li><li><a href="https://sun0day.github.io/blog/vite/why-vite4_3-is-faster.html#smarter-resolve-strategy">How we made Vite 4.3 faaaaster</a></li><li><a href="https://github.com/vitejs/vite/blob/v4.4.9/packages/vite/CHANGELOG.md#430-2023-04-20">github.com&#x2F;vitejs&#x2F;vite&#x2F;pulls</a></li></ul>]]></content>
    
    
    <summary type="html">vite4.3是如何更快的,为什么Vite 4.3比Vite 4.2性能提高了这么多</summary>
    
    
    
    <category term="优化" scheme="https://coding.zyha.cn/categories/%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="vue" scheme="https://coding.zyha.cn/tags/vue/"/>
    
    <category term="vite" scheme="https://coding.zyha.cn/tags/vite/"/>
    
    <category term="前端" scheme="https://coding.zyha.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>ip收费的新规将影响到lightsail</title>
    <link href="https://coding.zyha.cn/aws-ip-charge/"/>
    <id>https://coding.zyha.cn/aws-ip-charge/</id>
    <published>2023-07-29T16:23:43.000Z</published>
    <updated>2023-07-29T16:23:43.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>AWS</code><a href="https://aws.amazon.com/blogs/aws/new-aws-public-ipv4-address-charge-public-ip-insights/">新规</a>，将在2024年收取每个公网ip每月3.5usd左右的费用。</p><span id="more"></span><p>这篇文章里没有明确写lightsail，但是lightsail的ip也是公网ip，所以也会受到影响。</p><p>下面是我提问后官方人员给出的<a href="https://repost.aws/questions/QUT9M2DAKiQTSkOXZnaYYR0g/does-lightsail-charge-extra-ip-fees">答复</a>：<br><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20230730000356.png?x-oss-process=style/blog"></p><p>是的，公共IPv4地址的收费变更将应用于Lightsail。新的指控将于2024年2月1日生效。</p><p>以下是更改的细节：</p><p>所有公共IPv4地址，无论是否连接到服务，每个IP每小时将收取0.005美元的费用。在更改生效后的头12个月，每月前750小时的公共IPv4地址使用将是免费的。您拥有并使用Amazon BYOIP带到AWS的IP地址不会被收取费用。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;code&gt;AWS&lt;/code&gt;&lt;a href=&quot;https://aws.amazon.com/blogs/aws/new-aws-public-ipv4-address-charge-public-ip-insights/&quot;&gt;新规&lt;/a&gt;，将在2024年收取每个公网ip每月3.5usd左右的费用。&lt;/p&gt;</summary>
    
    
    
    <category term="vps" scheme="https://coding.zyha.cn/categories/vps/"/>
    
    
    <category term="vps" scheme="https://coding.zyha.cn/tags/vps/"/>
    
    <category term="aws" scheme="https://coding.zyha.cn/tags/aws/"/>
    
    <category term="lightsail" scheme="https://coding.zyha.cn/tags/lightsail/"/>
    
  </entry>
  
  <entry>
    <title>梳理新机的开发环境</title>
    <link href="https://coding.zyha.cn/check-new-machine-development-environment/"/>
    <id>https://coding.zyha.cn/check-new-machine-development-environment/</id>
    <published>2023-07-08T08:48:29.000Z</published>
    <updated>2023-07-08T08:48:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>新买了个组装机当主力开发机器，梳理一下开发环境的基础配置清单，以备以后重新安装了系统后用。</p><span id="more"></span><h2 id="浏览器-Chrome"><a href="#浏览器-Chrome" class="headerlink" title="浏览器-Chrome"></a>浏览器-<a href="https://www.google.com/chrome">Chrome</a></h2><p>如今的win系统都已经预装了EDGE，但是在部分场景下，比如后端接口使用自定义的SSL证书来调试时，EDGE无法完成请求，所以还是优先选择Chrome。</p><h2 id="包管理器-n"><a href="#包管理器-n" class="headerlink" title="包管理器-n"></a>包管理器-<a href="https://nodejs.org/en/download/package-manager#n">n</a></h2><p>本来一直都是用的<code>nvm-windows</code>，看仓库还一直在维护，但是不知道为啥很久没发新包了，所以就换成了<code>n</code>。</p><p>朋友推荐说<code>n</code>是一个类似的<code>node</code>版本管理器，可以方便的切换<code>node</code>版本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://raw.githubusercontent.com/tj/n/master/bin/n | bash -s lts</span><br><span class="line">npm install -g n</span><br><span class="line">n lts <span class="comment"># 安装最新的lts版本</span></span><br></pre></td></tr></table></figure><p>Mac下可以使用<code>brew</code>安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install gh</span><br></pre></td></tr></table></figure><h2 id="代码编辑器-vscode"><a href="#代码编辑器-vscode" class="headerlink" title="代码编辑器-vscode"></a>代码编辑器-vscode</h2><p>最常用的还得是vscode，但是vscode的插件安装和配置是个麻烦事，所以我选择了登录后同步配置，这样以后换机器或者重装系统后，只要登录账号就可以同步配置了。另外，推荐设置为使用管理员身份打开，否则可能会出现奇奇怪怪的权限问题。</p><p><a href="https://www.jetbrains.com/">idea</a>也是个不错的选择，但是我用的比较少，所以就不做介绍了。</p><h2 id="✈️"><a href="#✈️" class="headerlink" title="✈️"></a>✈️</h2><p>这位更是重量级。</p><h2 id="版本管理"><a href="#版本管理" class="headerlink" title="版本管理"></a>版本管理</h2><h3 id="git"><a href="#git" class="headerlink" title="git"></a><a href="https://git-scm.com/">git</a></h3><p>git可以说是开发必备的，但是我一直都是用的<code>github cli</code>，所以就不做介绍了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;your name&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;your email&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 跨平台开发时解决换行符问题</span></span><br><span class="line">git config --global core.autocrlf <span class="literal">false</span></span><br><span class="line">git config --global core.safecrlf <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="gh"><a href="#gh" class="headerlink" title="gh"></a><a href="https://cli.github.com/">gh</a></h3><p>github官方出品的命令行工具，可以方便的在命令行中操作github，比如创建仓库、创建issue、创建pr等等。有个比较方便的地方就是，可以直接登录github使用，不需要再去配置ssh key了。不过和git的命令有些不同，也有点额外的学习负担。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brew install gh</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">scoop install gh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gh auth login <span class="comment"># 登录github</span></span><br><span class="line">gh repo create <span class="comment"># 创建仓库</span></span><br><span class="line">gh repo <span class="built_in">clone</span> <span class="comment"># 克隆仓库</span></span><br><span class="line">gh repo <span class="built_in">sync</span> <span class="comment"># 同步仓库</span></span><br><span class="line">gh issue create <span class="comment"># 创建issue</span></span><br><span class="line">gh <span class="built_in">pr</span> create <span class="comment"># 创建pr</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="下载器-neatDownloadManager"><a href="#下载器-neatDownloadManager" class="headerlink" title="下载器-neatDownloadManager"></a>下载器-<a href="https://www.jetbrains.com/">neatDownloadManager</a></h2><p>作为idm的替代品，虽然个人体验没有idm强，但是胜在免费+跨平台。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;新买了个组装机当主力开发机器，梳理一下开发环境的基础配置清单，以备以后重新安装了系统后用。&lt;/p&gt;</summary>
    
    
    
    <category term="优化" scheme="https://coding.zyha.cn/categories/%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="开发环境" scheme="https://coding.zyha.cn/tags/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    
    <category term="解决方案" scheme="https://coding.zyha.cn/tags/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    
  </entry>
  
  <entry>
    <title>【面试】成都元生汇面试复盘</title>
    <link href="https://coding.zyha.cn/yuan-sheng-hui-fe-interview/"/>
    <id>https://coding.zyha.cn/yuan-sheng-hui-fe-interview/</id>
    <published>2023-06-11T07:26:01.000Z</published>
    <updated>2023-06-11T07:26:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>这家前两面的技术和技术经理给我的印象都很好，最值得点赞的是，只要通过了当场就能进行下一面。</p><span id="more"></span><h2 id="笔试"><a href="#笔试" class="headerlink" title="笔试"></a>笔试</h2><p>就两页，总共8道题的样子，比之前的公司大的笔试题都少。把还能想起来的题目都记一下。</p><ul><li>css选择器优先级</li><li>小程序的生命周期</li><li>export、module.exports的区别（在此之前完全不知道）</li><li>Vue的生命周期</li><li>uni-app组件传值</li><li>promise解决了什么问题</li></ul><h2 id="一面"><a href="#一面" class="headerlink" title="一面"></a>一面</h2><p>忘了录音，把还能记下来的记一下。</p><ul><li>展示项目<ul><li>演示能够演示的项目，并给出亮点</li><li>他提出我项目中的推送也算是亮点</li></ul></li><li>经典问题之从输入URL到页面展示</li><li>流程审批如何做的</li><li>了解过小程序吗，了解uni-app吗<ul><li>想具体问小程序，但我没项目开发经验就没仔细问</li></ul></li><li>用过的Vue3新特性</li><li>宏任务和微任务</li><li>ref&#x2F;reactive的区别</li><li>要自适应网页如何做<ul><li>回答到了媒体查询，使用相对值（百分比、rem、em、vh、vw等），使用flex&#x2F;grid布局</li></ul></li></ul><p>最后，面试官的一句：你的技术比我的还好，不要紧张，好好面。不管是他谦虚还是真的，但这句话真的给了我很大的鼓励。</p><h2 id="二面"><a href="#二面" class="headerlink" title="二面"></a>二面</h2><p>技术经理就简历上的一些点很愉快的聊了一下，没有聊具体的技术实现。</p><p>包括简历上的在校期间获得的奖项，工作中用到的技术栈，还聊了聊公司的未来可能做的项目等等。</p><h2 id="三面"><a href="#三面" class="headerlink" title="三面"></a>三面</h2><p>等他开会等了40分钟以上。</p><ul><li>你面试了多少家？</li><li>10多家。</li><li>都没offer？</li><li>有，外省的都给了，成都的没有。</li><li>成都的一个offer没有？</li><li>有，比较低，不到我的心里预期。</li><li><strong>那一定是你有问题。</strong></li></ul><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>面完之后，那个第三面的刘总说如果通过了第二天给我打电话确认薪资，第二天，我在boss直聘上询问面试结果，已读不回。</p><h2 id="参考答案"><a href="#参考答案" class="headerlink" title="参考答案"></a>参考答案</h2><p><a href="https://juejin.cn/post/7241854869224194107">https://juejin.cn/post/7241854869224194107</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;这家前两面的技术和技术经理给我的印象都很好，最值得点赞的是，只要通过了当场就能进行下一面。&lt;/p&gt;</summary>
    
    
    
    <category term="面试" scheme="https://coding.zyha.cn/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
    <category term="前端" scheme="https://coding.zyha.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="面试" scheme="https://coding.zyha.cn/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>【面试】经典问题之从输入URL到页面展示</title>
    <link href="https://coding.zyha.cn/from-input-url-to-page-display/"/>
    <id>https://coding.zyha.cn/from-input-url-to-page-display/</id>
    <published>2023-06-03T09:04:50.000Z</published>
    <updated>2023-06-03T09:04:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>看阿里的面经又看到了这个，之前虽然复习过，但是还是有些模糊，这次再复习一下。</p><span id="more"></span><h2 id="简略版"><a href="#简略版" class="headerlink" title="简略版"></a>简略版</h2><h3 id="1-输入URL"><a href="#1-输入URL" class="headerlink" title="1. 输入URL"></a>1. 输入URL</h3><ol><li>解析<code>URL</code></li><li>检查<code>HSTS</code>列表</li><li><code>DNS</code>解析</li><li><code>TCP</code>三次握手</li><li>发送<code>HTTP</code>请求</li></ol><h3 id="2-服务器处理请求"><a href="#2-服务器处理请求" class="headerlink" title="2. 服务器处理请求"></a>2. 服务器处理请求</h3><ol><li>服务器处理请求</li><li>服务器返回响应</li></ol><h3 id="3-浏览器解析渲染"><a href="#3-浏览器解析渲染" class="headerlink" title="3. 浏览器解析渲染"></a>3. 浏览器解析渲染</h3><ol><li>解析<code>HTML</code>生成<code>DOM</code>树<br>- 标记化<br>- 建树</li><li>解析<code>CSS</code>生成<code>CSSOM</code>树<br>- 格式化样式表<br>- 标准化样式属性<br>- 计算每个节点的具体样式：继承和层叠</li><li><code>DOM</code>树和<code>CSSOM</code>树结合生成渲染树</li><li>根据渲染树计算每个节点的信息</li><li>浏览器根据计算好的信息渲染页面<br>- 建立图层树<br>- 生成绘制列表<br>- 生成图块并栅格化<br>- 显示器显示内容</li></ol><h2 id="详细版"><a href="#详细版" class="headerlink" title="详细版"></a>详细版</h2><h3 id="1-解析URL并发起请求"><a href="#1-解析URL并发起请求" class="headerlink" title="1. 解析URL并发起请求"></a>1. 解析URL并发起请求</h3><p>浏览器在解析URL后会构建请求行: 请求行包括请求方法、请求地址和 HTTP 协议版本。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> 请求方法是GET，路径为根路径，HTTP协议版本为<span class="number">1.1</span></span><br><span class="line">GET <span class="regexp">/ HTTP/</span><span class="number">1.1</span></span><br></pre></td></tr></table></figure><h4 id="1-1-浏览器检查自带的“预加载-HSTS（HTTP严格传输安全）”列表"><a href="#1-1-浏览器检查自带的“预加载-HSTS（HTTP严格传输安全）”列表" class="headerlink" title="1.1 浏览器检查自带的“预加载 HSTS（HTTP严格传输安全）”列表"></a>1.1 浏览器检查自带的“预加载 HSTS（HTTP严格传输安全）”列表</h4><ul><li>这个列表里包含了只使用<code>HTTPS</code>进行连接的域名。如果网站在这个列表里，浏览器会使用 <code>HTTPS</code> 而不是 <code>HTTP</code> 协议，否则，最初的请求会使用<code>HTTP</code>协议发送</li><li>网站不在 <code>HSTS</code> 列表里，也可以要求浏览器使用 <code>HSTS</code> 政策进行访问。浏览器向网站发出第一个 <code>HTTP</code> 请求之后，网站会返回浏览器一个响应，再次请求浏览器时只使用 <code>HTTPS</code> 发送请求。这里的第一个 <code>HTTP</code> 请求，可能会使用户受到 <code>downgrade attack</code> 的威胁，所以现代浏览器都预置了 <code>HSTS</code> 列表。</li></ul><h4 id="1-2-DNS-查询"><a href="#1-2-DNS-查询" class="headerlink" title="1.2 DNS 查询"></a>1.2 DNS 查询</h4><ul><li>浏览器检查域名是否在缓存当中（要查看 <code>Chrome</code> 当中的缓存， 打开 <code>chrome://net-internals/#dns</code>）。</li><li>如果缓存中没有，就去调用 <code>gethostbyname</code> 库函数（操作系统不同函数也不同）进行查询。</li><li><code>gethostbyname</code> 函数在进行DNS解析之前,先检查域名是否在本地 <code>Hosts</code></li><li>如果 <code>gethostbyname</code> 没有这个域名的缓存记录，也没有在 <code>hosts</code> 里找到，它将会向 <code>DNS</code> 服务器发送一条 <code>DNS</code> 查询请求。</li><li><code>DNS</code> 服务器是由网络通信栈提供的，通常是本地路由器或者 <code>ISP</code> 的缓存 <code>DNS</code> 服务器。</li><li>查询本地 <code>DNS</code> 服务器时，如果 <code>DNS</code> 服务器主机在同一子网内，系统会对 <code>DNS</code> 服务器进行 <code>ARP</code>查询；如果在不同的子网，系统会按照下面的 <code>ARP</code> 过程对默认网关进行查询</li><li>从客户端到本地DNS服务器是属于<strong>递归查询</strong>，而本地DNS服务器与根域名服务器，顶级域名服务器，权威服务器之间是<strong>迭代查询</strong>。</li></ul><h4 id="1-3-TCP三次握手"><a href="#1-3-TCP三次握手" class="headerlink" title="1.3 TCP三次握手"></a>1.3 TCP三次握手</h4><ul><li><code>Chrome</code> 在同一个域名下要求同时最多只能有 <code>6</code> 个 <code>TCP</code> 连接，超过 <code>6</code> 个的话剩下的请求就得等待。</li><li>客户端选择一个初始序列号(ISN)，将设置了 <code>SYN</code> 位的封包发送给服务器端，表明自己要建立连接并设置了初始序列号</li><li>服务器端接收到 <code>SYN</code> 包，如果它可以建立连接：<ul><li>服务器端选择它自己的初始序列号</li><li>服务器端设置 <code>SYN</code> 位，表明自己选择了一个初始序列号</li><li>服务器端把 (客户端<code>ISN + 1</code>) 复制到 <code>ACK</code> 域，并且设置 <code>ACK</code> 位，表明自己接收到了客户端的第一个封包</li></ul></li><li>客户端通过发送下面一个封包来确认这次连接：<ul><li>自己的序列号<code>+1</code></li><li>接收端 <code>ACK+1</code></li><li>设置 <code>ACK</code> 位</li></ul></li><li>数据通过下面的方式传输：<ul><li>当一方发送了<code>N</code>个 <code>Bytes</code> 的数据之后，将自己的 <code>SEQ</code> 序列号也增加N</li><li>另一方确认接收到这个数据包（或者一系列数据包）之后，它发送一个 <code>ACK</code> 包，<code>ACK</code> 的值设置为接收到的数据包的最后一个序列号</li></ul></li><li>关闭连接时：<ul><li>要关闭连接的一方发送一个 <code>FIN</code> 包</li><li>另一方确认这个 <code>FIN</code> 包，并且发送自己的 <code>FIN</code> 包</li><li>要关闭的一方使用 <code>ACK</code> 包来确认接收到了 <code>FIN</code></li></ul></li></ul><h4 id="1-4-发送HTTP请求"><a href="#1-4-发送HTTP请求" class="headerlink" title="1.4 发送HTTP请求"></a>1.4 发送HTTP请求</h4><ul><li>浏览器发 <code>HTTP</code> 请求要携带三样东西:<strong>请求行、请求头和请求体</strong>。</li><li>请求头，比如<code>Cache-Control</code>、<code>If-Modified-Since</code>、<code>If-None-Match</code>都由可能被放入请求头中作为缓存的标识信息。</li><li>请求体只有在<code>POST</code>方法下存在，常见的场景是表单提交。</li></ul><h3 id="2-服务器端处理"><a href="#2-服务器端处理" class="headerlink" title="2. 服务器端处理"></a>2. 服务器端处理</h3><p>服务端收到请求后经过处理后，返回响应。跟请求部分类似，网络响应具有三个部分:响应行、响应头和响应体。</p><ul><li>响应行由HTTP协议版本、状态码和状态描述组成。<br><code>HTTP/1.1 200 OK</code></li><li>响应头包含了服务器及其返回数据的一些信息, 服务器生成数据的时间、返回的数据类型以及对即将写入的<code>Cookie</code>信息。</li><li>响应后是否断开，要判断<code>Connection</code>字段, 如果请求头或响应头中包含<code>Connection: Keep-Alive</code>，表示建立了持久连接，这样TCP连接会一直保持，之后请求统一站点的资源会复用这个连接。否则断开TCP连接, 请求-响应流程结束。</li></ul><h3 id="3-浏览器解析渲染-1"><a href="#3-浏览器解析渲染-1" class="headerlink" title="3. 浏览器解析渲染"></a>3. 浏览器解析渲染</h3><p>完成了网络请求和响应，如果响应头中Content-Type的值是text&#x2F;html，那么接下来就是浏览器的解析和渲染工作了。</p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20230603212734.png?x-oss-process=style/blog" alt="WebKit内核工作流程"></p><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSI0IiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgaWQ9InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAiIGF0dHJpYnV0ZU5hbWU9InIiIGJlZ2luPSIwO3N2Z1NwaW5uZXJzM0RvdHNTY2FsZTEuZW5kLTAuMjVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIGZpbGw9ImN1cnJlbnRDb2xvciI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNnMiIGR1cj0iMC43NXMiIHZhbHVlcz0iMzsuMjszIi8+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMjAiIGN5PSIxMiIgcj0iMyIgZmlsbD0iY3VycmVudENvbG9yIj48YW5pbWF0ZSBpZD0ic3ZnU3Bpbm5lcnMzRG90c1NjYWxlMSIgYXR0cmlidXRlTmFtZT0iciIgYmVnaW49InN2Z1NwaW5uZXJzM0RvdHNTY2FsZTAuZW5kLTAuNDVzIiBkdXI9IjAuNzVzIiB2YWx1ZXM9IjM7LjI7MyIvPjwvY2lyY2xlPjwvc3ZnPg==" data-original="https://cdn.zyha.cn/blog/20230603212836.png?x-oss-process=style/blog" alt="Gecko内核工作流程"></p><p>由于Webkit占据了大量的市场份额，所以这里以Webkit为例，介绍浏览器的解析和渲染过程。</p><h4 id="3-1-解析"><a href="#3-1-解析" class="headerlink" title="3.1 解析"></a>3.1 解析</h4><ul><li>构建 <code>DOM</code> 树<ul><li>解析树是以 <code>DOM</code> 元素以及属性为节点的树。</li><li>整个 <code>DOM</code> 和 <code>HTML</code> 文档几乎是一对一的关系。</li><li><code>DOM</code> 树的构建过程是一个<strong>深度遍历</strong>过程：当前节点的所有子节点都构建好后才会去构建当前节点的下一个兄弟节点。</li><li>解析算法在 <code>HTML5</code> 标准<a href="https://html.spec.whatwg.org/multipage/parsing.html">规范</a>中有详细介绍，算法主要包含了两个阶段：标记化（tokenization）和树的构建。也就是就是词法分析和语法分析。</li><li>标记化：输入为<code>HTML</code>文本，输出为HTML标记，也成为标记生成器。其中运用有限自动状态机来完成。即在当当前状态下，接收一个或多个字符，就会更新到下一个状态。</li><li>建树：解析器首先会创建一个<code>document</code>对象。标记生成器会把每个标记的信息发送给建树器。建树器接收到相应的标记时，会创建对应的 <code>DOM</code> 对象。先将DOM对象加入 DOM 树中，再将对应标记压入存放开放(与闭合标签意思对应)元素的栈中。</li></ul></li><li>样式计算<ul><li>根据 CSS词法和句法分析三种来源：CSS文件； <code>&lt;style&gt;</code> 标签中的样式； <code>style</code> 属性的值</li><li>CSS解析器可能是自顶向下的，也可能是使用解析器生成器生成的自底向上的解析器</li><li>格式化样式表：每个CSS文件都被解析成一个样式表对象<code>StyleSheet object</code>，这个对象包含带有选择器的CSS规则，和对应CSS语法的对象</li><li>标准化样式属性：有一些 CSS 样式的数值并不容易被渲染引擎所理解，因此需要在计算样式之前将它们标准化</li><li>计算每个节点的具体样式：继承和层叠。每个子节点都会默认继承父节点的样式属性，如果父节点中没有找到，就会采用浏览器默认样式，也叫UserAgent样式。这就是继承规则。然后是层叠规则，CSS 最大的特点在于它的层叠性，也就是最终的样式取决于各个属性共同作用的效果，甚至有很多诡异的层叠现象，看过《CSS世界》的同学应该对此深有体会，具体的层叠规则属于深入 CSS 语言的范畴，这里就不过多介绍了。</li></ul></li><li>生成渲染树<ul><li>通过浏览器的布局系统确定元素的位置</li><li>遍历生成的 DOM 树节点，并把他们添加到渲染树中。</li><li>计算渲染树节点的坐标位置。</li></ul></li></ul><h4 id="3-2-渲染"><a href="#3-2-渲染" class="headerlink" title="3.2 渲染"></a>3.2 渲染</h4><ul><li>建立图层树<ul><li>浏览器在构建完渲染树之后，还会对特定的节点进行分层，构建一棵图层树</li><li>节点的图层会默认属于父亲节点的图层(这些图层也称为合成层)。</li><li>什么时候会提升为一个单独的合成层：显式合成；隐式合成</li><li>显示合成：拥有层叠上下文的节点；需要剪裁的地方</li><li>隐式合成：层叠等级低的节点被提升为单独的图层之后，那么所有层叠等级比它高的节点都会成为一个单独的图层。</li></ul></li><li>生成绘制列表<ul><li>渲染引擎会将图层的绘制拆分成一个个绘制指令，比如先画背景、再描绘边框……然后将这些指令按顺序组合成一个待绘制列表，相当于给后面的绘制操作进行计划。</li></ul></li><li>生成图块并栅格化<ul><li>在渲染进程中绘制操作是由专门的合成线程来完成。</li><li>绘制列表准备好了之后，渲染进程的主线程会给合成线程发送<code>commit</code>消息，把绘制列表提交给合成线程。</li><li>合成线程要做的第一件事情就是将图层分块。</li><li>渲染进程中专门维护了一个栅格化线程池，专门负责把图块转换为位图数据。然后合成线程会选择视口附近的图块，把它交给栅格化线程池生成位图。</li><li>生成位图的过程实际上都会使用 <code>GPU</code> 进行加速，生成的位图最后发送给合成线程。</li></ul></li><li>显示器显示内容<ul><li>栅格化操作完成后，合成线程会生成一个绘制命令，即<code>&quot;DrawQuad&quot;</code>，并发送给浏览器进程。</li><li>浏览器进程中的<code>viz</code>组件接收到这个命令，根据这个命令，把页面内容绘制到内存，也就是生成了页面，然后把这部分内存发送给显卡。</li><li>显示器显示图像的原理：无论是 <code>PC</code> 显示器还是手机屏幕，都有一个固定的刷新频率，一般是 <code>60 HZ</code>，即 <code>60</code> 帧，也就是一秒更新 <code>60</code> 张图片，一张图片停留的时间约为 <code>16.7 ms</code>。而每次更新的图片都来自显卡的前缓冲区。而显卡接收到浏览器进程传来的页面后，会合成相应的图像，并将图像保存到后缓冲区，然后系统自动将前缓冲区和后缓冲区对换位置，如此循环更新。</li></ul></li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://web.dev/howbrowserswork/">How browsers work</a></li><li><a href="https://github.com/LaicZhang/what-happens-when-zh_CN#html">What-happens-when</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;看阿里的面经又看到了这个，之前虽然复习过，但是还是有些模糊，这次再复习一下。&lt;/p&gt;</summary>
    
    
    
    <category term="面试" scheme="https://coding.zyha.cn/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
    <category term="前端" scheme="https://coding.zyha.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="面试" scheme="https://coding.zyha.cn/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>使用cloudflare-workers反代pixiv</title>
    <link href="https://coding.zyha.cn/cloudflare-workers-proxy-pixiv/"/>
    <id>https://coding.zyha.cn/cloudflare-workers-proxy-pixiv/</id>
    <published>2023-06-01T13:15:32.000Z</published>
    <updated>2023-06-01T13:15:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>打算起个新项目，可能会用点p站的图来装饰，就反代一下。</p><p><code>CloudFlare Workers</code>具有强大的可扩展性以及在海外，基于此可以实现更多有趣的事，比如部署各种项目，搭建网盘，以及各种代理。</p><p>2023.6.1 实测可用</p><span id="more"></span><h2 id="实现的功能"><a href="#实现的功能" class="headerlink" title="实现的功能"></a>实现的功能</h2><ul><li>能访问<code>pixiv</code>图片资源域名<code>i.pximg.net</code></li><li>由于<code>i.pximg.net</code>有盗链保护，所有请求头<code>Referer</code>若非<code>pixiv</code>则<code>403</code>，反代后可以自行修改请求头</li></ul><h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">addEventListener</span>(<span class="string">&quot;fetch&quot;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(event.<span class="property">request</span>.<span class="property">url</span>);</span><br><span class="line">  url.<span class="property">hostname</span> = <span class="string">&quot;i.pximg.net&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> request = <span class="keyword">new</span> <span class="title class_">Request</span>(url, event.<span class="property">request</span>);</span><br><span class="line">  event.<span class="title function_">respondWith</span>(</span><br><span class="line">    <span class="title function_">fetch</span>(request, &#123;</span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;https://www.pixiv.net/&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Cloudflare Workers&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>将<code>i.pximg.net</code>替换为部署的地址<code>xxx.xxx.workers.dev</code>即可。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;打算起个新项目，可能会用点p站的图来装饰，就反代一下。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;CloudFlare Workers&lt;/code&gt;具有强大的可扩展性以及在海外，基于此可以实现更多有趣的事，比如部署各种项目，搭建网盘，以及各种代理。&lt;/p&gt;
&lt;p&gt;2023.6.1 实测可用&lt;/p&gt;</summary>
    
    
    
    <category term="cf" scheme="https://coding.zyha.cn/categories/cf/"/>
    
    
    <category term="cf" scheme="https://coding.zyha.cn/tags/cf/"/>
    
  </entry>
  
  <entry>
    <title>【面试】复盘加面试官提出的建议</title>
    <link href="https://coding.zyha.cn/some-advice-from-interviewer/"/>
    <id>https://coding.zyha.cn/some-advice-from-interviewer/</id>
    <published>2023-05-25T03:13:50.000Z</published>
    <updated>2023-05-25T03:13:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>每次面试完会在交流环节都向面试官询问本次面试的评价，并请提出建议。之前实习面试的时候忘了记录，这次想起来了就一起记录下来。</p><span id="more"></span><h2 id="提问"><a href="#提问" class="headerlink" title="提问"></a>提问</h2><p>先吐槽一句，我面试的明明是Vue前端开发，结果问的最多的居然是Python相关。</p><ul><li>python爬虫做了哪些优化</li><li>如何应对反爬的</li><li>python多线程有了解吗</li><li>在项目中主要负责哪些模块，遇到的问题，如何解决的</li></ul><h2 id="建议"><a href="#建议" class="headerlink" title="建议"></a>建议</h2><ul><li>简历上应该注明，标明项目所使用的技术栈</li><li>在参与的项目中的负责的具体模块，以及遇到的问题并如何解决</li><li>尽量提供可以演示的项目链接或截图，让面试官可以直观的看到在项目中的贡献</li><li>找到项目中的差异化点，突出自己的优势</li></ul><p>没说几点，但是确实都是是有参考价值的。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;每次面试完会在交流环节都向面试官询问本次面试的评价，并请提出建议。之前实习面试的时候忘了记录，这次想起来了就一起记录下来。&lt;/p&gt;</summary>
    
    
    
    <category term="面试" scheme="https://coding.zyha.cn/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
    <category term="面试" scheme="https://coding.zyha.cn/tags/%E9%9D%A2%E8%AF%95/"/>
    
    <category term="复盘" scheme="https://coding.zyha.cn/tags/%E5%A4%8D%E7%9B%98/"/>
    
  </entry>
  
</feed>
